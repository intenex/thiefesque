!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=53)}([function(t,e,i){"use strict";const n=2.3283064365386963e-10;class r{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(t){return t=t<1?1/t:t,this._seed=t,this._s0=(t>>>0)*n,t=69069*t+1>>>0,this._s1=t*n,t=69069*t+1>>>0,this._s2=t*n,this._c=1,this}getUniform(){let t=2091639*this._s0+this._c*n;return this._s0=this._s1,this._s1=this._s2,this._c=0|t,this._s2=t-this._c,this._s2}getUniformInt(t,e){let i=Math.max(t,e),n=Math.min(t,e);return Math.floor(this.getUniform()*(i-n+1))+n}getNormal(t=0,e=1){let i,n,r;do{r=(i=2*this.getUniform()-1)*i+(n=2*this.getUniform()-1)*n}while(r>1||0==r);return t+i*Math.sqrt(-2*Math.log(r)/r)*e}getPercentage(){return 1+Math.floor(100*this.getUniform())}getItem(t){return t.length?t[Math.floor(this.getUniform()*t.length)]:null}shuffle(t){let e=[],i=t.slice();for(;i.length;){let t=i.indexOf(this.getItem(i));e.push(i.splice(t,1)[0])}return e}getWeightedValue(t){let e=0;for(let i in t)e+=t[i];let i,n=this.getUniform()*e,r=0;for(i in t)if(n<(r+=t[i]))return i;return i}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this}clone(){return(new r).setState(this.getState())}}e.a=(new r).setSeed(Date.now())},function(t,e,i){"use strict";function n(t,e){return(t%e+e)%e}function r(t,e=0,i=1){return t<e?e:t>i?i:t}function s(t){return t.charAt(0).toUpperCase()+t.substring(1)}function o(t,...e){let i=o.map;return t.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,function(n,r,o,a){if("%"==t.charAt(a-1))return n.substring(1);if(!e.length)return n;let h=e[0],c=(r||o).split(","),l=c.shift()||"",u=i[l.toLowerCase()];if(!u)return n;let d=(h=e.shift())[u].apply(h,c),g=l.charAt(0);return g!=g.toLowerCase()&&(d=s(d)),d})}i.r(e),i.d(e,"mod",function(){return n}),i.d(e,"clamp",function(){return r}),i.d(e,"capitalize",function(){return s}),i.d(e,"format",function(){return o}),o.map={s:"toString"}},function(t,e,i){"use strict";i.r(e),i.d(e,"fromString",function(){return s}),i.d(e,"add",function(){return o}),i.d(e,"add_",function(){return a}),i.d(e,"multiply",function(){return h}),i.d(e,"multiply_",function(){return c}),i.d(e,"interpolate",function(){return l}),i.d(e,"lerp",function(){return u}),i.d(e,"interpolateHSL",function(){return d}),i.d(e,"lerpHSL",function(){return g}),i.d(e,"randomize",function(){return f}),i.d(e,"rgb2hsl",function(){return p}),i.d(e,"hsl2rgb",function(){return m}),i.d(e,"toRGB",function(){return v}),i.d(e,"toHex",function(){return y});var n=i(1),r=i(0);function s(t){let e,i;if(t in b)e=b[t];else{if("#"==t.charAt(0)){let i=(t.match(/[0-9a-f]/gi)||[]).map(t=>parseInt(t,16));if(3==i.length)e=i.map(t=>17*t);else{for(let t=0;t<3;t++)i[t+1]+=16*i[t],i.splice(t,1);e=i}}else e=(i=t.match(/rgb\(([0-9, ]+)\)/i))?i[1].split(/\s*,\s*/).map(t=>parseInt(t)):[0,0,0];b[t]=e}return e.slice()}function o(t,...e){let i=t.slice();for(let t=0;t<3;t++)for(let n=0;n<e.length;n++)i[t]+=e[n][t];return i}function a(t,...e){for(let i=0;i<3;i++)for(let n=0;n<e.length;n++)t[i]+=e[n][i];return t}function h(t,...e){let i=t.slice();for(let t=0;t<3;t++){for(let n=0;n<e.length;n++)i[t]*=e[n][t]/255;i[t]=Math.round(i[t])}return i}function c(t,...e){for(let i=0;i<3;i++){for(let n=0;n<e.length;n++)t[i]*=e[n][i]/255;t[i]=Math.round(t[i])}return t}function l(t,e,i=.5){let n=t.slice();for(let r=0;r<3;r++)n[r]=Math.round(n[r]+i*(e[r]-t[r]));return n}const u=l;function d(t,e,i=.5){let n=p(t),r=p(e);for(let t=0;t<3;t++)n[t]+=i*(r[t]-n[t]);return m(n)}const g=d;function f(t,e){e instanceof Array||(e=Math.round(r.a.getNormal(0,e)));let i=t.slice();for(let t=0;t<3;t++)i[t]+=e instanceof Array?Math.round(r.a.getNormal(0,e[t])):e;return i}function p(t){let e,i=t[0]/255,n=t[1]/255,r=t[2]/255,s=Math.max(i,n,r),o=Math.min(i,n,r),a=0,h=(s+o)/2;if(s==o)e=0;else{let t=s-o;switch(e=h>.5?t/(2-s-o):t/(s+o),s){case i:a=(n-r)/t+(n<r?6:0);break;case n:a=(r-i)/t+2;break;case r:a=(i-n)/t+4}a/=6}return[a,e,h]}function _(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}function m(t){let e=t[2];if(0==t[1])return[e=Math.round(255*e),e,e];{let i=t[1],n=e<.5?e*(1+i):e+i-e*i,r=2*e-n,s=_(r,n,t[0]+1/3),o=_(r,n,t[0]),a=_(r,n,t[0]-1/3);return[Math.round(255*s),Math.round(255*o),Math.round(255*a)]}}function v(t){return`rgb(${t.map(t=>Object(n.clamp)(t,0,255)).join(",")})`}function y(t){return`#${t.map(t=>Object(n.clamp)(t,0,255).toString(16).padStart(2,"0")).join("")}`}const b={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]}},function(t,e){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});class n{getContainer(){return null}setOptions(t){this._options=t}}},function(t,e,i){var n=i(11),r=i(30),s=i(31),o="[object Null]",a="[object Undefined]",h=n?n.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?a:o:h&&h in Object(t)?r(t):s(t)}},function(t,e,i){var n=i(12),r="object"==typeof self&&self&&self.Object===Object&&self,s=n||r||Function("return this")();t.exports=s},function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},function(t,e,i){"use strict";(function(t){i.d(e,"a",function(){return o});var n=i(4),r=i(2);function s(t){let e=r.fromString(t);return 36*Math.floor(e[0]*(6/256))+6*Math.floor(e[1]*(6/256))+1*Math.floor(e[2]*(6/256))+16}class o extends n.a{constructor(){super(),this._offset=[0,0],this._cursor=[-1,-1],this._lastColor=""}schedule(t){setTimeout(t,1e3/60)}setOptions(t){super.setOptions(t);let e=[t.width,t.height],i=this.computeSize();this._offset=i.map((t,i)=>Math.floor((t-e[i])/2))}clear(){t.stdout.write(`[0;48;5;${s(this._options.bg)}m[2J`)}draw(e,i){let[n,r,o,a,h]=e,c=this._offset[0]+n,l=this._offset[1]+r,u=this.computeSize();if(c<0||c>=u[0])return;if(l<0||l>=u[1])return;if(c===this._cursor[0]&&l===this._cursor[1]||(t.stdout.write(function(t,e){return`[${e+1};${t+1}H`}(c,l)),this._cursor[0]=c,this._cursor[1]=l),i&&(o||(o=" ")),!o)return;let d=function(t,e){return`[0;38;5;${s(t)};48;5;${s(e)}m`}(a,h);d!==this._lastColor&&(t.stdout.write(d),this._lastColor=d);let g=[].concat(o);t.stdout.write(g[0]),this._cursor[0]++,this._cursor[0]>=u[0]&&(this._cursor[0]=0,this._cursor[1]++)}computeFontSize(){throw new Error("Terminal backend has no notion of font size")}eventToPosition(t,e){return[t,e]}computeSize(){return[t.stdout.columns,t.stdout.rows]}}}).call(this,i(19))},function(t,e){t.exports=function(t){return t}},function(t,e,i){var n=i(5),r=i(3),s="[object AsyncFunction]",o="[object Function]",a="[object GeneratorFunction]",h="[object Proxy]";t.exports=function(t){if(!r(t))return!1;var e=n(t);return e==o||e==a||e==s||e==h}},function(t,e,i){var n=i(6).Symbol;t.exports=n},function(t,e,i){(function(e){var i="object"==typeof e&&e&&e.Object===Object&&e;t.exports=i}).call(this,i(29))},function(t,e){t.exports=function(t,e){return t===e||t!=t&&e!=e}},function(t,e,i){var n=i(10),r=i(15);t.exports=function(t){return null!=t&&r(t.length)&&!n(t)}},function(t,e){var i=9007199254740991;t.exports=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=i}},function(t,e){var i=9007199254740991,n=/^(?:0|[1-9]\d*)$/;t.exports=function(t,e){var r=typeof t;return!!(e=null==e?i:e)&&("number"==r||"symbol"!=r&&n.test(t))&&t>-1&&t%1==0&&t<e}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,i){var n=i(20),r=i(13),s=i(37),o=i(38),a=Object.prototype,h=a.hasOwnProperty,c=n(function(t,e){t=Object(t);var i=-1,n=e.length,c=n>2?e[2]:void 0;for(c&&s(e[0],e[1],c)&&(n=1);++i<n;)for(var l=e[i],u=o(l),d=-1,g=u.length;++d<g;){var f=u[d],p=t[f];(void 0===p||r(p,a[f])&&!h.call(t,f))&&(t[f]=l[f])}return t});t.exports=c},function(t,e){var i,n,r=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===s||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:s}catch(t){i=s}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(t){n=o}}();var h,c=[],l=!1,u=-1;function d(){l&&h&&(l=!1,h.length?c=h.concat(c):u=-1,c.length&&g())}function g(){if(!l){var t=a(d);l=!0;for(var e=c.length;e;){for(h=c,c=[];++u<e;)h&&h[u].run();u=-1,e=c.length}h=null,l=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function p(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];c.push(new f(t,e)),1!==c.length||l||a(g)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e,i){var n=i(9),r=i(21),s=i(23);t.exports=function(t,e){return s(r(t,e,n),t+"")}},function(t,e,i){var n=i(22),r=Math.max;t.exports=function(t,e,i){return e=r(void 0===e?t.length-1:e,0),function(){for(var s=arguments,o=-1,a=r(s.length-e,0),h=Array(a);++o<a;)h[o]=s[e+o];o=-1;for(var c=Array(e+1);++o<e;)c[o]=s[o];return c[e]=i(h),n(t,this,c)}}},function(t,e){t.exports=function(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}},function(t,e,i){var n=i(24),r=i(36)(n);t.exports=r},function(t,e,i){var n=i(25),r=i(26),s=i(9),o=r?function(t,e){return r(t,"toString",{configurable:!0,enumerable:!1,value:n(e),writable:!0})}:s;t.exports=o},function(t,e){t.exports=function(t){return function(){return t}}},function(t,e,i){var n=i(27),r=function(){try{var t=n(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=r},function(t,e,i){var n=i(28),r=i(35);t.exports=function(t,e){var i=r(t,e);return n(i)?i:void 0}},function(t,e,i){var n=i(10),r=i(32),s=i(3),o=i(34),a=/^\[object .+?Constructor\]$/,h=Function.prototype,c=Object.prototype,l=h.toString,u=c.hasOwnProperty,d=RegExp("^"+l.call(u).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=function(t){return!(!s(t)||r(t))&&(n(t)?d:a).test(o(t))}},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){var n=i(11),r=Object.prototype,s=r.hasOwnProperty,o=r.toString,a=n?n.toStringTag:void 0;t.exports=function(t){var e=s.call(t,a),i=t[a];try{t[a]=void 0;var n=!0}catch(t){}var r=o.call(t);return n&&(e?t[a]=i:delete t[a]),r}},function(t,e){var i=Object.prototype.toString;t.exports=function(t){return i.call(t)}},function(t,e,i){var n,r=i(33),s=(n=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";t.exports=function(t){return!!s&&s in t}},function(t,e,i){var n=i(6)["__core-js_shared__"];t.exports=n},function(t,e){var i=Function.prototype.toString;t.exports=function(t){if(null!=t){try{return i.call(t)}catch(t){}try{return t+""}catch(t){}}return""}},function(t,e){t.exports=function(t,e){return null==t?void 0:t[e]}},function(t,e){var i=800,n=16,r=Date.now;t.exports=function(t){var e=0,s=0;return function(){var o=r(),a=n-(o-s);if(s=o,a>0){if(++e>=i)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}},function(t,e,i){var n=i(13),r=i(14),s=i(16),o=i(3);t.exports=function(t,e,i){if(!o(i))return!1;var a=typeof e;return!!("number"==a?r(i)&&s(e,i.length):"string"==a&&e in i)&&n(i[e],t)}},function(t,e,i){var n=i(39),r=i(50),s=i(14);t.exports=function(t){return s(t)?n(t,!0):r(t)}},function(t,e,i){var n=i(40),r=i(41),s=i(43),o=i(44),a=i(16),h=i(46),c=Object.prototype.hasOwnProperty;t.exports=function(t,e){var i=s(t),l=!i&&r(t),u=!i&&!l&&o(t),d=!i&&!l&&!u&&h(t),g=i||l||u||d,f=g?n(t.length,String):[],p=f.length;for(var _ in t)!e&&!c.call(t,_)||g&&("length"==_||u&&("offset"==_||"parent"==_)||d&&("buffer"==_||"byteLength"==_||"byteOffset"==_)||a(_,p))||f.push(_);return f}},function(t,e){t.exports=function(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}},function(t,e,i){var n=i(42),r=i(7),s=Object.prototype,o=s.hasOwnProperty,a=s.propertyIsEnumerable,h=n(function(){return arguments}())?n:function(t){return r(t)&&o.call(t,"callee")&&!a.call(t,"callee")};t.exports=h},function(t,e,i){var n=i(5),r=i(7),s="[object Arguments]";t.exports=function(t){return r(t)&&n(t)==s}},function(t,e){var i=Array.isArray;t.exports=i},function(t,e,i){(function(t){var n=i(6),r=i(45),s=e&&!e.nodeType&&e,o=s&&"object"==typeof t&&t&&!t.nodeType&&t,a=o&&o.exports===s?n.Buffer:void 0,h=(a?a.isBuffer:void 0)||r;t.exports=h}).call(this,i(17)(t))},function(t,e){t.exports=function(){return!1}},function(t,e,i){var n=i(47),r=i(48),s=i(49),o=s&&s.isTypedArray,a=o?r(o):n;t.exports=a},function(t,e,i){var n=i(5),r=i(15),s=i(7),o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1,t.exports=function(t){return s(t)&&r(t.length)&&!!o[n(t)]}},function(t,e){t.exports=function(t){return function(e){return t(e)}}},function(t,e,i){(function(t){var n=i(12),r=e&&!e.nodeType&&e,s=r&&"object"==typeof t&&t&&!t.nodeType&&t,o=s&&s.exports===r&&n.process,a=function(){try{var t=s&&s.require&&s.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=a}).call(this,i(17)(t))},function(t,e,i){var n=i(3),r=i(51),s=i(52),o=Object.prototype.hasOwnProperty;t.exports=function(t){if(!n(t))return s(t);var e=r(t),i=[];for(var a in t)("constructor"!=a||!e&&o.call(t,a))&&i.push(a);return i}},function(t,e){var i=Object.prototype;t.exports=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||i)}},function(t,e){t.exports=function(t){var e=[];if(null!=t)for(var i in Object(t))e.push(i);return e}},function(t,e,i){"use strict";i.r(e);var n={};i.r(n),i.d(n,"TYPE_TEXT",function(){return d}),i.d(n,"TYPE_NEWLINE",function(){return g}),i.d(n,"TYPE_FG",function(){return f}),i.d(n,"TYPE_BG",function(){return p}),i.d(n,"measure",function(){return _}),i.d(n,"tokenize",function(){return m});i(0);var r=i(4);class s extends r.a{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(t){requestAnimationFrame(t)}getContainer(){return this._ctx.canvas}setOptions(t){super.setOptions(t);const e=`${t.fontStyle?`${t.fontStyle} `:""} ${t.fontSize}px ${t.fontFamily}`;this._ctx.font=e,this._updateSize(),this._ctx.font=e,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)}eventToPosition(t,e){let i=this._ctx.canvas,n=i.getBoundingClientRect();return t-=n.left,e-=n.top,t*=i.width/n.width,e*=i.height/n.height,t<0||e<0||t>=i.width||e>=i.height?[-1,-1]:this._normalizedEventToPosition(t,e)}}var o=i(1);class a extends s{constructor(){super(),this._spacingX=0,this._spacingY=0,this._hexSize=0}draw(t,e){let[i,n,r,s,o]=t,a=[(i+1)*this._spacingX,n*this._spacingY+this._hexSize];if(this._options.transpose&&a.reverse(),e&&(this._ctx.fillStyle=o,this._fill(a[0],a[1])),!r)return;this._ctx.fillStyle=s;let h=[].concat(r);for(let t=0;t<h.length;t++)this._ctx.fillText(h[t],a[0],Math.ceil(a[1]))}computeSize(t,e){return this._options.transpose&&(t+=e,t-=e=t-e),[Math.floor(t/this._spacingX)-1,Math.floor((e-2*this._hexSize)/this._spacingY+1)]}computeFontSize(t,e){this._options.transpose&&(t+=e,t-=e=t-e);let i=2*t/((this._options.width+1)*Math.sqrt(3))-1,n=e/(2+1.5*(this._options.height-1)),r=Math.min(i,n),s=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let o=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=s;let a=o/100,h=2*(r=Math.floor(r)+1)/(this._options.spacing*(1+a/Math.sqrt(3)));return Math.ceil(h)-1}_normalizedEventToPosition(t,e){let i;this._options.transpose?(t+=e,t-=e=t-e,i=this._ctx.canvas.width):i=this._ctx.canvas.height;let n=i/this._options.height;return e=Math.floor(e/n),Object(o.mod)(e,2)?(t-=this._spacingX,t=1+2*Math.floor(t/(2*this._spacingX))):t=2*Math.floor(t/(2*this._spacingX)),[t,e]}_fill(t,e){let i=this._hexSize,n=this._options.border;const r=this._ctx;r.beginPath(),this._options.transpose?(r.moveTo(t-i+n,e),r.lineTo(t-i/2+n,e+this._spacingX-n),r.lineTo(t+i/2-n,e+this._spacingX-n),r.lineTo(t+i-n,e),r.lineTo(t+i/2-n,e-this._spacingX+n),r.lineTo(t-i/2+n,e-this._spacingX+n),r.lineTo(t-i+n,e)):(r.moveTo(t,e-i+n),r.lineTo(t+this._spacingX-n,e-i/2+n),r.lineTo(t+this._spacingX-n,e+i/2-n),r.lineTo(t,e+i-n),r.lineTo(t-this._spacingX+n,e+i/2-n),r.lineTo(t-this._spacingX+n,e-i/2+n),r.lineTo(t,e-i+n)),r.fill()}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);let i,n;this._hexSize=Math.floor(t.spacing*(t.fontSize+e/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=1.5*this._hexSize,t.transpose?(i="height",n="width"):(i="width",n="height"),this._ctx.canvas[i]=Math.ceil((t.width+1)*this._spacingX),this._ctx.canvas[n]=Math.ceil((t.height-1)*this._spacingY+2*this._hexSize)}}class h extends s{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(t){super.setOptions(t),this._canvasCache={}}draw(t,e){h.cache?this._drawWithCache(t):this._drawNoCache(t,e)}_drawWithCache(t){let e,[i,n,r,s,o]=t,a=""+r+s+o;if(a in this._canvasCache)e=this._canvasCache[a];else{let t=this._options.border,i=(e=document.createElement("canvas")).getContext("2d");if(e.width=this._spacingX,e.height=this._spacingY,i.fillStyle=o,i.fillRect(t,t,e.width-t,e.height-t),r){i.fillStyle=s,i.font=this._ctx.font,i.textAlign="center",i.textBaseline="middle";let t=[].concat(r);for(let e=0;e<t.length;e++)i.fillText(t[e],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[a]=e}this._ctx.drawImage(e,i*this._spacingX,n*this._spacingY)}_drawNoCache(t,e){let[i,n,r,s,o]=t;if(e){let t=this._options.border;this._ctx.fillStyle=o,this._ctx.fillRect(i*this._spacingX+t,n*this._spacingY+t,this._spacingX-t,this._spacingY-t)}if(!r)return;this._ctx.fillStyle=s;let a=[].concat(r);for(let t=0;t<a.length;t++)this._ctx.fillText(a[t],(i+.5)*this._spacingX,Math.ceil((n+.5)*this._spacingY))}computeSize(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}computeFontSize(t,e){let i=Math.floor(t/this._options.width),n=Math.floor(e/this._options.height),r=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let s=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=r;let o=s/100*n/i;return o>1&&(n=Math.floor(n/o)),Math.floor(n/this._options.spacing)}_normalizedEventToPosition(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(t.spacing*e),this._spacingY=Math.ceil(t.spacing*t.fontSize),t.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=t.width*this._spacingX,this._ctx.canvas.height=t.height*this._spacingY}}h.cache=!1;class c extends s{constructor(){super(),this._colorCanvas=document.createElement("canvas")}draw(t,e){let[i,n,r,s,o]=t,a=this._options.tileWidth,h=this._options.tileHeight;if(e&&(this._options.tileColorize?this._ctx.clearRect(i*a,n*h,a,h):(this._ctx.fillStyle=o,this._ctx.fillRect(i*a,n*h,a,h))),!r)return;let c=[].concat(r),l=[].concat(s),u=[].concat(o);for(let t=0;t<c.length;t++){let e=this._options.tileMap[c[t]];if(!e)throw new Error(`Char "${c[t]}" not found in tileMap`);if(this._options.tileColorize){let r=this._colorCanvas,s=r.getContext("2d");s.globalCompositeOperation="source-over",s.clearRect(0,0,a,h);let o=l[t],c=u[t];s.drawImage(this._options.tileSet,e[0],e[1],a,h,0,0,a,h),"transparent"!=o&&(s.fillStyle=o,s.globalCompositeOperation="source-atop",s.fillRect(0,0,a,h)),"transparent"!=c&&(s.fillStyle=c,s.globalCompositeOperation="destination-over",s.fillRect(0,0,a,h)),this._ctx.drawImage(r,i*a,n*h,a,h)}else this._ctx.drawImage(this._options.tileSet,e[0],e[1],a,h,i*a,n*h,a,h)}}computeSize(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}_normalizedEventToPosition(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}_updateSize(){const t=this._options;this._ctx.canvas.width=t.width*t.tileWidth,this._ctx.canvas.height=t.height*t.tileHeight,this._colorCanvas.width=t.tileWidth,this._colorCanvas.height=t.tileHeight}}var l=i(8);const u=/%([bc]){([^}]*)}/g,d=0,g=1,f=2,p=3;function _(t,e){let i={width:0,height:1},n=m(t,e),r=0;for(let t=0;t<n.length;t++){let e=n[t];switch(e.type){case d:r+=e.value.length;break;case g:i.height++,i.width=Math.max(i.width,r),r=0}}return i.width=Math.max(i.width,r),i}function m(t,e){let i=[],n=0;t.replace(u,function(e,r,s,o){let a=t.substring(n,o);return a.length&&i.push({type:d,value:a}),i.push({type:"c"==r?f:p,value:s.trim()}),n=o+e.length,""});let r=t.substring(n);return r.length&&i.push({type:d,value:r}),function(t,e){e||(e=1/0);let i=0,n=0,r=-1;for(;i<t.length;){let s=t[i];if(s.type==g&&(n=0,r=-1),s.type!=d){i++;continue}for(;0==n&&" "==s.value.charAt(0);)s.value=s.value.substring(1);let o=s.value.indexOf("\n");if(-1!=o){s.value=v(t,i,o,!0);let e=s.value.split("");for(;e.length&&" "==e[e.length-1];)e.pop();s.value=e.join("")}if(s.value.length){if(n+s.value.length>e){let o=-1;for(;;){let t=s.value.indexOf(" ",o+1);if(-1==t)break;if(n+t>e)break;o=t}if(-1!=o)s.value=v(t,i,o,!0);else if(-1!=r){let e=t[r],n=e.value.lastIndexOf(" ");e.value=v(t,r,n,!0),i=r}else s.value=v(t,i,e-n,!1)}else n+=s.value.length,-1!=s.value.indexOf(" ")&&(r=i);i++}else t.splice(i,1)}t.push({type:g});let s=null;for(let e=0;e<t.length;e++){let i=t[e];switch(i.type){case d:s=i;break;case g:if(s){let t=s.value.split("");for(;t.length&&" "==t[t.length-1];)t.pop();s.value=t.join("")}s=null}}return t.pop(),t}(i,e)}function v(t,e,i,n){let r={type:g},s={type:d,value:t[e].value.substring(i+(n?1:0))};return t.splice(e+1,0,r,s),t[e].value.substring(0,i)}let y=80,b=25;const x=13,w=27,M=32,k=37,S=38,T=39,E=40,j=65,O=67,A=68,P=69,z=73,C=75,Y=79,X=80,F=81,q=87,$=88,D=90,R=188,H=190,W=191,N={hex:a,rect:h,tile:c,term:l.a},L={width:y,height:b,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1};class I{constructor(t={}){this._data={},this._dirty=!1,this._options={},t=Object.assign({},L,t),this.setOptions(t),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}DEBUG(t,e,i){let n=[this._options.bg,this._options.fg];this.draw(t,e,null,null,n[i%n.length])}clear(){this._data={},this._dirty=!0}setOptions(t){if(Object.assign(this._options,t),t.width||t.height||t.fontSize||t.fontFamily||t.spacing||t.layout){if(t.layout){let e=N[t.layout];this._backend=new e}this._backend.setOptions(this._options),this._dirty=!0}return this}getOptions(){return this._options}getContainer(){return this._backend.getContainer()}computeSize(t,e){return this._backend.computeSize(t,e)}computeFontSize(t,e){return this._backend.computeFontSize(t,e)}computeTileSize(t,e){return[Math.floor(t/this._options.width),Math.floor(e/this._options.height)]}eventToPosition(t){let e,i;return"touches"in t?(e=t.touches[0].clientX,i=t.touches[0].clientY):(e=t.clientX,i=t.clientY),this._backend.eventToPosition(e,i)}draw(t,e,i,n,r){n||(n=this._options.fg),r||(r=this._options.bg);let s=`${t},${e}`;this._data[s]=[t,e,i,n,r],!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[s]=!0)}drawText(t,e,i,n){let r=null,s=null,o=t,a=e,h=1;n||(n=this._options.width-t);let c=m(i,n);for(;c.length;){let e=c.shift();switch(e.type){case d:let i=!1,n=!1,c=!1,l=!1;for(let t=0;t<e.value.length;t++){let h=e.value.charCodeAt(t),u=e.value.charAt(t);c=h>65280&&h<65377||h>65500&&h<65512||h>65518,i=32==u.charCodeAt(0)||12288==u.charCodeAt(0),!l||c||i||o++,c&&!n&&o++,this.draw(o++,a,u,r,s),n=i,l=c}break;case f:r=e.value||null;break;case p:s=e.value||null;break;case g:o=t,a++,h++}}return h}_tick(){if(this._backend.schedule(this._tick),this._dirty){if(!0===this._dirty){this._backend.clear();for(let t in this._data)this._draw(t,!1)}else for(let t in this._dirty)this._draw(t,!0);this._dirty=!1}}_draw(t,e){let i=this._data[t];i[4]!=this._options.bg&&(e=!0),this._backend.draw(i,e)}}I.Rect=h,I.Hex=a,I.Tile=c,I.Term=l.a;class Z{constructor(){this._time=0,this._events=[],this._eventTimes=[]}getTime(){return this._time}clear(){return this._events=[],this._eventTimes=[],this}add(t,e){let i=this._events.length;for(let t=0;t<this._eventTimes.length;t++)if(this._eventTimes[t]>e){i=t;break}this._events.splice(i,0,t),this._eventTimes.splice(i,0,e)}get(){if(!this._events.length)return null;let t=this._eventTimes.splice(0,1)[0];if(t>0){this._time+=t;for(let e=0;e<this._eventTimes.length;e++)this._eventTimes[e]-=t}return this._events.splice(0,1)[0]}getEventTime(t){let e=this._events.indexOf(t);if(-1!=e)return this._eventTimes[e]}remove(t){let e=this._events.indexOf(t);return-1!=e&&(this._remove(e),!0)}_remove(t){this._events.splice(t,1),this._eventTimes.splice(t,1)}}class U{constructor(){this._queue=new Z,this._repeat=[],this._current=null}getTime(){return this._queue.getTime()}add(t,e){return e&&this._repeat.push(t),this}getTimeOf(t){return this._queue.getEventTime(t)}clear(){return this._queue.clear(),this._repeat=[],this._current=null,this}remove(t){let e=this._queue.remove(t),i=this._repeat.indexOf(t);return-1!=i&&this._repeat.splice(i,1),this._current==t&&(this._current=null),e}next(){return this._current=this._queue.get(),this._current}}var B={Simple:class extends U{add(t,e){return this._queue.add(t,0),super.add(t,e)}next(){return this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,0),super.next()}},Speed:class extends U{add(t,e,i){return this._queue.add(t,void 0!==i?i:1/t.getSpeed()),super.add(t,e)}next(){return this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,1/this._current.getSpeed()),super.next()}},Action:class extends U{constructor(){super(),this._defaultDuration=1,this._duration=this._defaultDuration}add(t,e,i){return this._queue.add(t,i||this._defaultDuration),super.add(t,e)}clear(){return this._duration=this._defaultDuration,super.clear()}remove(t){return t==this._current&&(this._duration=this._defaultDuration),super.remove(t)}next(){return this._current&&-1!=this._repeat.indexOf(this._current)&&(this._queue.add(this._current,this._duration||this._defaultDuration),this._duration=this._defaultDuration),super.next()}setDuration(t){return this._current&&(this._duration=t),this}}};Math.sqrt(3),Math.sqrt(3);class V{constructor(t){this._scheduler=t,this._lock=1}start(){return this.unlock()}lock(){return this._lock++,this}unlock(){if(!this._lock)throw new Error("Cannot unlock unlocked engine");for(this._lock--;!this._lock;){let t=this._scheduler.next();if(!t)return this.lock();let e=t.act();e&&e.then&&(this.lock(),e.then(this.unlock.bind(this)))}return this}}var G=i(2);const J=G;var K=class{constructor(t,e,i){this.width=t,this.height=e,this.depth=i,this.tiles=[];for(let t=0;t<i;t++)this.tiles.push(this.generateLevel())}getTiles(){return this.tiles}getDepth(){return this.depth}getWidth(){return this.width}getHeight(){return this.height}generateLevel(){const t=[];for(let e=0;e<this.width;e++)t.push([]);return new ROT.Map.Digger(mapWidth,mapHeight).create((e,i,n)=>{t[e][i]=n?TILES.wallTile:TILES.floorTile}),t}};var Q=class{constructor(t={}){this.char=t.character||" ",this.foreground=t.foreground||"white",this.background=t.blackground||"black"}getChar(){return this.char}getForeground(){return this.foreground}getBackground(){return this.background}};class tt extends Q{constructor(t={}){super(t),this.walkable=t.walkable||!1,this.diggable=t.diggable||!1}isWalkable(){return this.walkable}isDiggable(){return this.diggable}getNeighborPositions(t,e){const i=[];for(let n=-1;n<2;n++)for(let r=-1;r<2;r++)0===n&&0===r||i.push({x:t+n,y:e+r});return i.randomize()}}const et=new tt,it=new tt({character:".",walkable:!0}),nt=(new tt({character:"#",foreground:"goldenrod",diggable:!0}),new tt({character:"<",foreground:"white",isWalkable:!0})),rt=new tt({character:">",foreground:"white",isWalkable:!0});var st=i(18),ot=i.n(st);class at extends Q{constructor(t={},e){super(t),this.game=e,this.name=t.name||"",this.x=t.x||0,this.z=t.z||0,this.y=t.y||0,this.map=null,this.attachedMixins={},this.attachedMixinGroups={},(t.mixins||[]).forEach(function(e){ot()(this,e),this.attachedMixins[e.name]=!0,e.groupName&&(this.attachedMixinGroups[e.groupName]=!0),e.init&&e.init.call(this,t)}.bind(this))}setMap(t){this.map=t}getMap(){return this.map}setName(t){this.name=t}setX(t){this.x=t}setY(t){this.y=t}setZ(t){this.z=t}getZ(){return this.z}getName(){return this.name}getX(){return this.x}getY(){return this.y}setPosition(t,e,i){this.x=t,this.y=e,this.z=i}hasMixin(t){return"object"==typeof t?this.attachedMixins[t.name]:this.attachedMixins[t]||this.attachedMixinGroups[t]}sendMessage(t,e){t.hasMixin(ht.MessageRecipient)&&t.receiveMessage(e)}sendMessageNearby(t,e,i,n,r){t.getEntitiesWithinRadius(e,i,n,5).forEach(t=>{t.hasMixin(ht.MessageRecipient)&&t.receiveMessage(r)})}}const ht={};ht.Moveable={name:"Moveable",tryMove(t,e,i,n){const r=n.getTile(t,e,this.getZ()),s=n.getEntityAt(t,e,this.getZ());if(i<this.getZ())r!==nt?this.sendMessage(this,"You can't go up here!"):(this.sendMessage(this,`You ascend to level ${i+1}!`),this.setPosition(t,e,i));else if(i>this.getZ())r!==rt?this.sendMessage(this,"You can't go down here!"):(this.sendMessage(this,`You descend to level ${i+1}!`),this.setPosition(t,e,i));else if(s)return!!this.hasMixin("Attacker")&&(this.attack(s),!0);return r.isWalkable()?(this.setPosition(t,e,i),!0):!!r.isDiggable()&&(n.dig(t,e,i),!0)}},ht.PlayerActor={name:"PlayerActor",groupName:"Actor",act(){this.game.refresh(),this.getMap().getEngine().lock(),this.clearMessages()}},ht.FungusActor={name:"FungusActor",groupName:"Actor",init(){this.growthsRemaining=5},act(){if(this.getZ()!==this.map.currentZ)return!1;if(this.growthsRemaining>0&&Math.random()<=.03){const t=Math.floor(3*Math.random())-1,e=Math.floor(3*Math.random())-1;if((0!==t||0!==e)&&this.getMap().isEmptyFloor(this.getX()+t,this.getY()+e,this.getZ())){const i=new at(ct.FungusTemplate);i.setPosition(this.getX()+t,this.getY()+e,this.getZ()),this.getMap().addEntity(i),this.growthsRemaining--,this.sendMessageNearby(this.getMap(),i.getX(),i.getY(),i.getZ(),"The fungus is spreading!")}}}},ht.Destructible={name:"Destructible",init(t){this.maxHP=t.maxHP||10,this.hp=t.hp||this.maxHP,this.defenseValue=t.defenseValue||0},getHP(){return this.hp},getMaxHP(){return this.maxHP},getDefenseValue(){return this.defenseValue},takeDamage(t,e){this.hp-=e,this.hp<=0&&(this.sendMessage(t,`You kill the ${this.getName()}`),this.sendMessage(this,"You die!"),this.getMap().removeEntity(this))}},ht.Attacker={name:"Attacker",groupName:"Attacker",init(t){this.attackValue=t.attackValue||1},getAttackValue(){return this.attackValue},attack(t){if(t.hasMixin("Destructible")){const e=this.getAttackValue(),i=t.getDefenseValue(),n=Math.max(0,e-i),r=1+Math.floor(Math.random()*n);this.sendMessage(this,`You strike the ${t.getName()} for ${r} damage!`),this.sendMessage(t,`The ${this.getName()} strikes you for ${r} damage!`),t.takeDamage(this,r)}}},ht.MessageRecipient={name:"MessageRecipient",init(t){this.messages=[]},receiveMessage(t){this.messages.push(t)},getMessages(){return this.messages},clearMessages(){this.messages=[]}};const ct={};ct.PlayerTemplate={character:"@",foreground:"white",maxHP:15,attackValue:5,defenseValue:2,mixins:[ht.PlayerActor,ht.Moveable,ht.Attacker,ht.Destructible,ht.MessageRecipient]},ct.FungusTemplate={name:"fungus",character:"F",foreground:"green",maxHP:6,mixins:[ht.FungusActor,ht.Destructible]};var lt=class{constructor(t,e){this.tiles=t,this.depth=t.length,this.width=t[0].length,this.height=t[0][0].length,this.entities={},this.currentZ=0,this.scheduler=new B.Simple,this.engine=new V(this.scheduler),this.addEntityAtRandomPosition(e,currentZ);for(let t=0;t<this.depth;t++)for(let e=0;e<25;e++)this.addEntityAtRandomPosition(new at(ct.FungusTemplate),t)}getEngine(){return this.engine}getEntities(){return this.entities}getEntityAt(t,e,i){return this.entities.z.forEach(i=>{if(i.getX()===t&&i.getY()===e)return i}),!1}getWidth(){return this.width}getHeight(){return this.height}getDepth(){return this.depth}getTile(t,e,i){return t<0||t>=this.width||e<0||e>=this.height||i<0||i>=this.depth?et:this.tiles[i][t][e]||et}dig(t,e,i){this.getTile(t,e,i).isDiggable()&&(this.tiles[i][t][e]=it)}getRandomFloorPosition(t){let e,i;do{e=Math.floor(Math.random()*this.width),i=Math.floor(Math.random()*this.width)}while(!this.isEmptyFloor(e,i,t));return{x:e,y:i,z:t}}addEntity(t){if(t.getX()<0||t.getX()>=this.width||t.getY()<0||t.getY()>=this.height||t.getZ()<0||t.getZ()>=this.depth)throw new Error("Adding entity out of bounds.");t.setMap(this),t.getZ(),this.entities.z?this.entities.z.push(t):this.entities.z=[t],t.hasMixin("Actor")&&this.scheduler.add(t,!0)}addEntityAtRandomPosition(t,e){const i=this.getRandomFloorPosition(e);t.setX(i.x),t.setY(i.y),t.setZ(i.z),this.addEntity(t)}removeEntity(t){Object.keys(this.entities).forEach(t=>{for(let t=0;t<this.entities.z.length;t++){this.entities.z.splice(t,1);break}}),t.hasMixin("Actor")&&this.scheduler.remove(t)}isEmptyFloor(t,e,i){return this.getTile(t,e,i)===it&&!this.getEntityAt(t,e,i)}getEntitiesWithinRadius(t,e,i,n){const r=[],s=t-n,o=t+n,a=e-n,h=e+n;return this.entities.currentZ.forEach(t=>{t.getX()>=s&&t.getX()<=o&&t.getY()>=a&&t.getY()<=h&&r.push(t)}),r}};class ut{constructor(t){this.screen_type=t}enter(){console.log(`Entered ${this.screen_type} screen.`)}exit(){console.log(`Exited ${this.screen_type} screen.`)}handleEvent(t){}}const dt=new ut("start");dt.render=function(t,e){e.drawText(1,1,"%c{yellow}Welcome to Thiefesque. Feel free to dig around."),e.drawText(1,2,"Press [Enter] to start.")},dt.handleEvent=function(t,e){e.keyCode!==M&&e.keyCode!==x||t.switchScreen(t.screens.playScreen)};const gt=new ut("play");gt.enter=function(t){const e=new K(100,100,6).getTiles();this.player=new at(ct.PlayerTemplate,t),this.map=new lt(e,this.player),this.map.getEngine().start()},gt.move=function(t,e,i){const n=this.player.getX()+t,r=this.player.getY()+e;this.player.tryMove(n,r,this.map),i.refresh()},gt.render=function(t,e){const i=t.getScreenWidth(),n=t.getScreenHeight();let r=Math.max(0,this.player.getX()-Math.floor(i/2));r=Math.min(r,this.map.getWidth()-i);let s=Math.max(0,this.player.getY()-Math.floor(n/2));s=Math.min(s,this.map.getHeight()-n);for(let t=r;t<r+i;t++)for(let i=s;i<s+n;i++){const n=this.map.getTile(t,i);e.draw(t-r,i-s,n.getChar(),n.getForeground(),n.getBackground())}this.map.getEntities().forEach(t=>{t.getX()>=r&&t.getY()>=s&&t.getX()<r+i&&t.getY()<s+n&&e.draw(t.getX()-r,t.getY()-s,t.getChar(),t.getForeground(),t.getBackground())}),this.player.getMessages().forEach((t,i)=>{e.drawText(0,i,`%c{white}%b{black}${t}`)});const o=`%c{white}%b{black}HP: ${this.player.getHP()}/${this.player.getMaxHP()}`;e.drawText(0,n,o)},gt.handleEvent=function(t,e){switch(e.keyCode){case M:case x:t.switchScreen(t.screens.winScreen);break;case w:t.switchScreen(t.screens.loseScreen);break;case Y:case q:case S:this.move(0,-1,t),this.map.getEngine().unlock();break;case X:case P:this.move(1,-1,t),this.map.getEngine().unlock();break;case 186:case A:case T:this.move(1,0,t),this.map.getEngine().unlock();break;case W:case O:this.move(1,1,t),this.map.getEngine().unlock();break;case H:case $:case E:this.move(0,1,t),this.map.getEngine().unlock();break;case R:case D:this.move(-1,1,t),this.map.getEngine().unlock();break;case C:case j:case k:this.move(-1,0,t),this.map.getEngine().unlock();break;case z:case F:this.move(-1,-1,t),this.map.getEngine().unlock()}};const ft=new ut("win");ft.render=function(t,e){for(let t=0;t<22;t++){const i=Math.round(255*Math.random()),n=Math.round(255*Math.random()),r=Math.round(255*Math.random()),s=J.toRGB([i,n,r]);e.drawText(2,t+1,`%b{${s}}You win!`)}};const pt=new ut("lose");pt.render=function(t,e){for(let t=0;t<22;t++)e.drawText(2,t+1,"%b{red}You lose! :(")};var _t=class{constructor(){this.map={},this.screenWidth=80,this.screenHeight=40,this.display=new I({width:this.screenWidth,height:this.screenHeight+1}),document.body.appendChild(this.display.getContainer()),this.screens={startScreen:dt,playScreen:gt,winScreen:ft,loseScreen:pt},this.screens.startScreen.handleEvent=this.screens.startScreen.handleEvent.bind(this.screens.startScreen,this),this.screens.playScreen.handleEvent=this.screens.playScreen.handleEvent.bind(this.screens.playScreen,this),this.switchScreen(this.screens.startScreen)}getDisplay(){return this.display}getScreenWidth(){return this.screenWidth}getScreenHeight(){return this.screenHeight}switchScreen(t){this.currentScreen&&(window.removeEventListener("keydown",this.currentScreen),this.currentScreen.exit()),this.getDisplay().clear(),this.currentScreen=t,this.currentScreen&&(this.currentScreen.enter(this),this.refresh()),window.addEventListener("keydown",this.currentScreen),window.addEventListener("keypress",this.currentScreen)}refresh(){this.display.clear(),this.currentScreen.render(this,this.display)}};document.addEventListener("DOMContentLoaded",()=>{new _t})}]);