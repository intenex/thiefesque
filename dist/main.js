!function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=53)}([function(t,e,i){"use strict";const n=2.3283064365386963e-10;class s{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(t){return t=t<1?1/t:t,this._seed=t,this._s0=(t>>>0)*n,t=69069*t+1>>>0,this._s1=t*n,t=69069*t+1>>>0,this._s2=t*n,this._c=1,this}getUniform(){let t=2091639*this._s0+this._c*n;return this._s0=this._s1,this._s1=this._s2,this._c=0|t,this._s2=t-this._c,this._s2}getUniformInt(t,e){let i=Math.max(t,e),n=Math.min(t,e);return Math.floor(this.getUniform()*(i-n+1))+n}getNormal(t=0,e=1){let i,n,s;do{s=(i=2*this.getUniform()-1)*i+(n=2*this.getUniform()-1)*n}while(s>1||0==s);return t+i*Math.sqrt(-2*Math.log(s)/s)*e}getPercentage(){return 1+Math.floor(100*this.getUniform())}getItem(t){return t.length?t[Math.floor(this.getUniform()*t.length)]:null}shuffle(t){let e=[],i=t.slice();for(;i.length;){let t=i.indexOf(this.getItem(i));e.push(i.splice(t,1)[0])}return e}getWeightedValue(t){let e=0;for(let i in t)e+=t[i];let i,n=this.getUniform()*e,s=0;for(i in t)if(n<(s+=t[i]))return i;return i}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this}clone(){return(new s).setState(this.getState())}}e.a=(new s).setSeed(Date.now())},function(t,e,i){"use strict";function n(t,e){return(t%e+e)%e}function s(t,e=0,i=1){return t<e?e:t>i?i:t}function r(t){return t.charAt(0).toUpperCase()+t.substring(1)}function o(t,...e){let i=o.map;return t.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,function(n,s,o,h){if("%"==t.charAt(h-1))return n.substring(1);if(!e.length)return n;let a=e[0],l=(s||o).split(","),c=l.shift()||"",u=i[c.toLowerCase()];if(!u)return n;let d=(a=e.shift())[u].apply(a,l),f=c.charAt(0);return f!=f.toLowerCase()&&(d=r(d)),d})}i.r(e),i.d(e,"mod",function(){return n}),i.d(e,"clamp",function(){return s}),i.d(e,"capitalize",function(){return r}),i.d(e,"format",function(){return o}),o.map={s:"toString"}},function(t,e,i){"use strict";i.r(e),i.d(e,"fromString",function(){return r}),i.d(e,"add",function(){return o}),i.d(e,"add_",function(){return h}),i.d(e,"multiply",function(){return a}),i.d(e,"multiply_",function(){return l}),i.d(e,"interpolate",function(){return c}),i.d(e,"lerp",function(){return u}),i.d(e,"interpolateHSL",function(){return d}),i.d(e,"lerpHSL",function(){return f}),i.d(e,"randomize",function(){return _}),i.d(e,"rgb2hsl",function(){return g}),i.d(e,"hsl2rgb",function(){return m}),i.d(e,"toRGB",function(){return b}),i.d(e,"toHex",function(){return y});var n=i(1),s=i(0);function r(t){let e,i;if(t in w)e=w[t];else{if("#"==t.charAt(0)){let i=(t.match(/[0-9a-f]/gi)||[]).map(t=>parseInt(t,16));if(3==i.length)e=i.map(t=>17*t);else{for(let t=0;t<3;t++)i[t+1]+=16*i[t],i.splice(t,1);e=i}}else e=(i=t.match(/rgb\(([0-9, ]+)\)/i))?i[1].split(/\s*,\s*/).map(t=>parseInt(t)):[0,0,0];w[t]=e}return e.slice()}function o(t,...e){let i=t.slice();for(let t=0;t<3;t++)for(let n=0;n<e.length;n++)i[t]+=e[n][t];return i}function h(t,...e){for(let i=0;i<3;i++)for(let n=0;n<e.length;n++)t[i]+=e[n][i];return t}function a(t,...e){let i=t.slice();for(let t=0;t<3;t++){for(let n=0;n<e.length;n++)i[t]*=e[n][t]/255;i[t]=Math.round(i[t])}return i}function l(t,...e){for(let i=0;i<3;i++){for(let n=0;n<e.length;n++)t[i]*=e[n][i]/255;t[i]=Math.round(t[i])}return t}function c(t,e,i=.5){let n=t.slice();for(let s=0;s<3;s++)n[s]=Math.round(n[s]+i*(e[s]-t[s]));return n}const u=c;function d(t,e,i=.5){let n=g(t),s=g(e);for(let t=0;t<3;t++)n[t]+=i*(s[t]-n[t]);return m(n)}const f=d;function _(t,e){e instanceof Array||(e=Math.round(s.a.getNormal(0,e)));let i=t.slice();for(let t=0;t<3;t++)i[t]+=e instanceof Array?Math.round(s.a.getNormal(0,e[t])):e;return i}function g(t){let e,i=t[0]/255,n=t[1]/255,s=t[2]/255,r=Math.max(i,n,s),o=Math.min(i,n,s),h=0,a=(r+o)/2;if(r==o)e=0;else{let t=r-o;switch(e=a>.5?t/(2-r-o):t/(r+o),r){case i:h=(n-s)/t+(n<s?6:0);break;case n:h=(s-i)/t+2;break;case s:h=(i-n)/t+4}h/=6}return[h,e,a]}function p(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}function m(t){let e=t[2];if(0==t[1])return[e=Math.round(255*e),e,e];{let i=t[1],n=e<.5?e*(1+i):e+i-e*i,s=2*e-n,r=p(s,n,t[0]+1/3),o=p(s,n,t[0]),h=p(s,n,t[0]-1/3);return[Math.round(255*r),Math.round(255*o),Math.round(255*h)]}}function b(t){return`rgb(${t.map(t=>Object(n.clamp)(t,0,255)).join(",")})`}function y(t){return`#${t.map(t=>Object(n.clamp)(t,0,255).toString(16).padStart(2,"0")).join("")}`}const w={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]}},function(t,e){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});class n{getContainer(){return null}setOptions(t){this._options=t}}},function(t,e,i){var n=i(11),s=i(30),r=i(31),o="[object Null]",h="[object Undefined]",a=n?n.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?h:o:a&&a in Object(t)?s(t):r(t)}},function(t,e,i){var n=i(12),s="object"==typeof self&&self&&self.Object===Object&&self,r=n||s||Function("return this")();t.exports=r},function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},function(t,e,i){"use strict";(function(t){i.d(e,"a",function(){return o});var n=i(4),s=i(2);function r(t){let e=s.fromString(t);return 36*Math.floor(e[0]*(6/256))+6*Math.floor(e[1]*(6/256))+1*Math.floor(e[2]*(6/256))+16}class o extends n.a{constructor(){super(),this._offset=[0,0],this._cursor=[-1,-1],this._lastColor=""}schedule(t){setTimeout(t,1e3/60)}setOptions(t){super.setOptions(t);let e=[t.width,t.height],i=this.computeSize();this._offset=i.map((t,i)=>Math.floor((t-e[i])/2))}clear(){t.stdout.write(`[0;48;5;${r(this._options.bg)}m[2J`)}draw(e,i){let[n,s,o,h,a]=e,l=this._offset[0]+n,c=this._offset[1]+s,u=this.computeSize();if(l<0||l>=u[0])return;if(c<0||c>=u[1])return;if(l===this._cursor[0]&&c===this._cursor[1]||(t.stdout.write(function(t,e){return`[${e+1};${t+1}H`}(l,c)),this._cursor[0]=l,this._cursor[1]=c),i&&(o||(o=" ")),!o)return;let d=function(t,e){return`[0;38;5;${r(t)};48;5;${r(e)}m`}(h,a);d!==this._lastColor&&(t.stdout.write(d),this._lastColor=d);let f=[].concat(o);t.stdout.write(f[0]),this._cursor[0]++,this._cursor[0]>=u[0]&&(this._cursor[0]=0,this._cursor[1]++)}computeFontSize(){throw new Error("Terminal backend has no notion of font size")}eventToPosition(t,e){return[t,e]}computeSize(){return[t.stdout.columns,t.stdout.rows]}}}).call(this,i(19))},function(t,e){t.exports=function(t){return t}},function(t,e,i){var n=i(5),s=i(3),r="[object AsyncFunction]",o="[object Function]",h="[object GeneratorFunction]",a="[object Proxy]";t.exports=function(t){if(!s(t))return!1;var e=n(t);return e==o||e==h||e==r||e==a}},function(t,e,i){var n=i(6).Symbol;t.exports=n},function(t,e,i){(function(e){var i="object"==typeof e&&e&&e.Object===Object&&e;t.exports=i}).call(this,i(29))},function(t,e){t.exports=function(t,e){return t===e||t!=t&&e!=e}},function(t,e,i){var n=i(10),s=i(15);t.exports=function(t){return null!=t&&s(t.length)&&!n(t)}},function(t,e){var i=9007199254740991;t.exports=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=i}},function(t,e){var i=9007199254740991,n=/^(?:0|[1-9]\d*)$/;t.exports=function(t,e){var s=typeof t;return!!(e=null==e?i:e)&&("number"==s||"symbol"!=s&&n.test(t))&&t>-1&&t%1==0&&t<e}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,i){var n=i(20),s=i(13),r=i(37),o=i(38),h=Object.prototype,a=h.hasOwnProperty,l=n(function(t,e){t=Object(t);var i=-1,n=e.length,l=n>2?e[2]:void 0;for(l&&r(e[0],e[1],l)&&(n=1);++i<n;)for(var c=e[i],u=o(c),d=-1,f=u.length;++d<f;){var _=u[d],g=t[_];(void 0===g||s(g,h[_])&&!a.call(t,_))&&(t[_]=c[_])}return t});t.exports=l},function(t,e){var i,n,s=t.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function h(t){if(i===setTimeout)return setTimeout(t,0);if((i===r||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:r}catch(t){i=r}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(t){n=o}}();var a,l=[],c=!1,u=-1;function d(){c&&a&&(c=!1,a.length?l=a.concat(l):u=-1,l.length&&f())}function f(){if(!c){var t=h(d);c=!0;for(var e=l.length;e;){for(a=l,l=[];++u<e;)a&&a[u].run();u=-1,e=l.length}a=null,c=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function _(t,e){this.fun=t,this.array=e}function g(){}s.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];l.push(new _(t,e)),1!==l.length||c||h(f)},_.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=g,s.addListener=g,s.once=g,s.off=g,s.removeListener=g,s.removeAllListeners=g,s.emit=g,s.prependListener=g,s.prependOnceListener=g,s.listeners=function(t){return[]},s.binding=function(t){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(t){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(t,e,i){var n=i(9),s=i(21),r=i(23);t.exports=function(t,e){return r(s(t,e,n),t+"")}},function(t,e,i){var n=i(22),s=Math.max;t.exports=function(t,e,i){return e=s(void 0===e?t.length-1:e,0),function(){for(var r=arguments,o=-1,h=s(r.length-e,0),a=Array(h);++o<h;)a[o]=r[e+o];o=-1;for(var l=Array(e+1);++o<e;)l[o]=r[o];return l[e]=i(a),n(t,this,l)}}},function(t,e){t.exports=function(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}},function(t,e,i){var n=i(24),s=i(36)(n);t.exports=s},function(t,e,i){var n=i(25),s=i(26),r=i(9),o=s?function(t,e){return s(t,"toString",{configurable:!0,enumerable:!1,value:n(e),writable:!0})}:r;t.exports=o},function(t,e){t.exports=function(t){return function(){return t}}},function(t,e,i){var n=i(27),s=function(){try{var t=n(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=s},function(t,e,i){var n=i(28),s=i(35);t.exports=function(t,e){var i=s(t,e);return n(i)?i:void 0}},function(t,e,i){var n=i(10),s=i(32),r=i(3),o=i(34),h=/^\[object .+?Constructor\]$/,a=Function.prototype,l=Object.prototype,c=a.toString,u=l.hasOwnProperty,d=RegExp("^"+c.call(u).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=function(t){return!(!r(t)||s(t))&&(n(t)?d:h).test(o(t))}},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){var n=i(11),s=Object.prototype,r=s.hasOwnProperty,o=s.toString,h=n?n.toStringTag:void 0;t.exports=function(t){var e=r.call(t,h),i=t[h];try{t[h]=void 0;var n=!0}catch(t){}var s=o.call(t);return n&&(e?t[h]=i:delete t[h]),s}},function(t,e){var i=Object.prototype.toString;t.exports=function(t){return i.call(t)}},function(t,e,i){var n,s=i(33),r=(n=/[^.]+$/.exec(s&&s.keys&&s.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";t.exports=function(t){return!!r&&r in t}},function(t,e,i){var n=i(6)["__core-js_shared__"];t.exports=n},function(t,e){var i=Function.prototype.toString;t.exports=function(t){if(null!=t){try{return i.call(t)}catch(t){}try{return t+""}catch(t){}}return""}},function(t,e){t.exports=function(t,e){return null==t?void 0:t[e]}},function(t,e){var i=800,n=16,s=Date.now;t.exports=function(t){var e=0,r=0;return function(){var o=s(),h=n-(o-r);if(r=o,h>0){if(++e>=i)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}},function(t,e,i){var n=i(13),s=i(14),r=i(16),o=i(3);t.exports=function(t,e,i){if(!o(i))return!1;var h=typeof e;return!!("number"==h?s(i)&&r(e,i.length):"string"==h&&e in i)&&n(i[e],t)}},function(t,e,i){var n=i(39),s=i(50),r=i(14);t.exports=function(t){return r(t)?n(t,!0):s(t)}},function(t,e,i){var n=i(40),s=i(41),r=i(43),o=i(44),h=i(16),a=i(46),l=Object.prototype.hasOwnProperty;t.exports=function(t,e){var i=r(t),c=!i&&s(t),u=!i&&!c&&o(t),d=!i&&!c&&!u&&a(t),f=i||c||u||d,_=f?n(t.length,String):[],g=_.length;for(var p in t)!e&&!l.call(t,p)||f&&("length"==p||u&&("offset"==p||"parent"==p)||d&&("buffer"==p||"byteLength"==p||"byteOffset"==p)||h(p,g))||_.push(p);return _}},function(t,e){t.exports=function(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}},function(t,e,i){var n=i(42),s=i(7),r=Object.prototype,o=r.hasOwnProperty,h=r.propertyIsEnumerable,a=n(function(){return arguments}())?n:function(t){return s(t)&&o.call(t,"callee")&&!h.call(t,"callee")};t.exports=a},function(t,e,i){var n=i(5),s=i(7),r="[object Arguments]";t.exports=function(t){return s(t)&&n(t)==r}},function(t,e){var i=Array.isArray;t.exports=i},function(t,e,i){(function(t){var n=i(6),s=i(45),r=e&&!e.nodeType&&e,o=r&&"object"==typeof t&&t&&!t.nodeType&&t,h=o&&o.exports===r?n.Buffer:void 0,a=(h?h.isBuffer:void 0)||s;t.exports=a}).call(this,i(17)(t))},function(t,e){t.exports=function(){return!1}},function(t,e,i){var n=i(47),s=i(48),r=i(49),o=r&&r.isTypedArray,h=o?s(o):n;t.exports=h},function(t,e,i){var n=i(5),s=i(15),r=i(7),o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1,t.exports=function(t){return r(t)&&s(t.length)&&!!o[n(t)]}},function(t,e){t.exports=function(t){return function(e){return t(e)}}},function(t,e,i){(function(t){var n=i(12),s=e&&!e.nodeType&&e,r=s&&"object"==typeof t&&t&&!t.nodeType&&t,o=r&&r.exports===s&&n.process,h=function(){try{var t=r&&r.require&&r.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=h}).call(this,i(17)(t))},function(t,e,i){var n=i(3),s=i(51),r=i(52),o=Object.prototype.hasOwnProperty;t.exports=function(t){if(!n(t))return r(t);var e=s(t),i=[];for(var h in t)("constructor"!=h||!e&&o.call(t,h))&&i.push(h);return i}},function(t,e){var i=Object.prototype;t.exports=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||i)}},function(t,e){t.exports=function(t){var e=[];if(null!=t)for(var i in Object(t))e.push(i);return e}},function(t,e,i){"use strict";i.r(e);var n={};i.r(n),i.d(n,"TYPE_TEXT",function(){return f}),i.d(n,"TYPE_NEWLINE",function(){return _}),i.d(n,"TYPE_FG",function(){return g}),i.d(n,"TYPE_BG",function(){return p}),i.d(n,"measure",function(){return m}),i.d(n,"tokenize",function(){return b});var s=i(0),r=i(4);class o extends r.a{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(t){requestAnimationFrame(t)}getContainer(){return this._ctx.canvas}setOptions(t){super.setOptions(t);const e=`${t.fontStyle?`${t.fontStyle} `:""} ${t.fontSize}px ${t.fontFamily}`;this._ctx.font=e,this._updateSize(),this._ctx.font=e,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)}eventToPosition(t,e){let i=this._ctx.canvas,n=i.getBoundingClientRect();return t-=n.left,e-=n.top,t*=i.width/n.width,e*=i.height/n.height,t<0||e<0||t>=i.width||e>=i.height?[-1,-1]:this._normalizedEventToPosition(t,e)}}var h=i(1);class a extends o{constructor(){super(),this._spacingX=0,this._spacingY=0,this._hexSize=0}draw(t,e){let[i,n,s,r,o]=t,h=[(i+1)*this._spacingX,n*this._spacingY+this._hexSize];if(this._options.transpose&&h.reverse(),e&&(this._ctx.fillStyle=o,this._fill(h[0],h[1])),!s)return;this._ctx.fillStyle=r;let a=[].concat(s);for(let t=0;t<a.length;t++)this._ctx.fillText(a[t],h[0],Math.ceil(h[1]))}computeSize(t,e){return this._options.transpose&&(t+=e,t-=e=t-e),[Math.floor(t/this._spacingX)-1,Math.floor((e-2*this._hexSize)/this._spacingY+1)]}computeFontSize(t,e){this._options.transpose&&(t+=e,t-=e=t-e);let i=2*t/((this._options.width+1)*Math.sqrt(3))-1,n=e/(2+1.5*(this._options.height-1)),s=Math.min(i,n),r=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let o=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=r;let h=o/100,a=2*(s=Math.floor(s)+1)/(this._options.spacing*(1+h/Math.sqrt(3)));return Math.ceil(a)-1}_normalizedEventToPosition(t,e){let i;this._options.transpose?(t+=e,t-=e=t-e,i=this._ctx.canvas.width):i=this._ctx.canvas.height;let n=i/this._options.height;return e=Math.floor(e/n),Object(h.mod)(e,2)?(t-=this._spacingX,t=1+2*Math.floor(t/(2*this._spacingX))):t=2*Math.floor(t/(2*this._spacingX)),[t,e]}_fill(t,e){let i=this._hexSize,n=this._options.border;const s=this._ctx;s.beginPath(),this._options.transpose?(s.moveTo(t-i+n,e),s.lineTo(t-i/2+n,e+this._spacingX-n),s.lineTo(t+i/2-n,e+this._spacingX-n),s.lineTo(t+i-n,e),s.lineTo(t+i/2-n,e-this._spacingX+n),s.lineTo(t-i/2+n,e-this._spacingX+n),s.lineTo(t-i+n,e)):(s.moveTo(t,e-i+n),s.lineTo(t+this._spacingX-n,e-i/2+n),s.lineTo(t+this._spacingX-n,e+i/2-n),s.lineTo(t,e+i-n),s.lineTo(t-this._spacingX+n,e+i/2-n),s.lineTo(t-this._spacingX+n,e-i/2+n),s.lineTo(t,e-i+n)),s.fill()}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);let i,n;this._hexSize=Math.floor(t.spacing*(t.fontSize+e/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=1.5*this._hexSize,t.transpose?(i="height",n="width"):(i="width",n="height"),this._ctx.canvas[i]=Math.ceil((t.width+1)*this._spacingX),this._ctx.canvas[n]=Math.ceil((t.height-1)*this._spacingY+2*this._hexSize)}}class l extends o{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(t){super.setOptions(t),this._canvasCache={}}draw(t,e){l.cache?this._drawWithCache(t):this._drawNoCache(t,e)}_drawWithCache(t){let e,[i,n,s,r,o]=t,h=""+s+r+o;if(h in this._canvasCache)e=this._canvasCache[h];else{let t=this._options.border,i=(e=document.createElement("canvas")).getContext("2d");if(e.width=this._spacingX,e.height=this._spacingY,i.fillStyle=o,i.fillRect(t,t,e.width-t,e.height-t),s){i.fillStyle=r,i.font=this._ctx.font,i.textAlign="center",i.textBaseline="middle";let t=[].concat(s);for(let e=0;e<t.length;e++)i.fillText(t[e],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[h]=e}this._ctx.drawImage(e,i*this._spacingX,n*this._spacingY)}_drawNoCache(t,e){let[i,n,s,r,o]=t;if(e){let t=this._options.border;this._ctx.fillStyle=o,this._ctx.fillRect(i*this._spacingX+t,n*this._spacingY+t,this._spacingX-t,this._spacingY-t)}if(!s)return;this._ctx.fillStyle=r;let h=[].concat(s);for(let t=0;t<h.length;t++)this._ctx.fillText(h[t],(i+.5)*this._spacingX,Math.ceil((n+.5)*this._spacingY))}computeSize(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}computeFontSize(t,e){let i=Math.floor(t/this._options.width),n=Math.floor(e/this._options.height),s=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let r=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=s;let o=r/100*n/i;return o>1&&(n=Math.floor(n/o)),Math.floor(n/this._options.spacing)}_normalizedEventToPosition(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(t.spacing*e),this._spacingY=Math.ceil(t.spacing*t.fontSize),t.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=t.width*this._spacingX,this._ctx.canvas.height=t.height*this._spacingY}}l.cache=!1;class c extends o{constructor(){super(),this._colorCanvas=document.createElement("canvas")}draw(t,e){let[i,n,s,r,o]=t,h=this._options.tileWidth,a=this._options.tileHeight;if(e&&(this._options.tileColorize?this._ctx.clearRect(i*h,n*a,h,a):(this._ctx.fillStyle=o,this._ctx.fillRect(i*h,n*a,h,a))),!s)return;let l=[].concat(s),c=[].concat(r),u=[].concat(o);for(let t=0;t<l.length;t++){let e=this._options.tileMap[l[t]];if(!e)throw new Error(`Char "${l[t]}" not found in tileMap`);if(this._options.tileColorize){let s=this._colorCanvas,r=s.getContext("2d");r.globalCompositeOperation="source-over",r.clearRect(0,0,h,a);let o=c[t],l=u[t];r.drawImage(this._options.tileSet,e[0],e[1],h,a,0,0,h,a),"transparent"!=o&&(r.fillStyle=o,r.globalCompositeOperation="source-atop",r.fillRect(0,0,h,a)),"transparent"!=l&&(r.fillStyle=l,r.globalCompositeOperation="destination-over",r.fillRect(0,0,h,a)),this._ctx.drawImage(s,i*h,n*a,h,a)}else this._ctx.drawImage(this._options.tileSet,e[0],e[1],h,a,i*h,n*a,h,a)}}computeSize(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}_normalizedEventToPosition(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}_updateSize(){const t=this._options;this._ctx.canvas.width=t.width*t.tileWidth,this._ctx.canvas.height=t.height*t.tileHeight,this._colorCanvas.width=t.tileWidth,this._colorCanvas.height=t.tileHeight}}var u=i(8);const d=/%([bc]){([^}]*)}/g,f=0,_=1,g=2,p=3;function m(t,e){let i={width:0,height:1},n=b(t,e),s=0;for(let t=0;t<n.length;t++){let e=n[t];switch(e.type){case f:s+=e.value.length;break;case _:i.height++,i.width=Math.max(i.width,s),s=0}}return i.width=Math.max(i.width,s),i}function b(t,e){let i=[],n=0;t.replace(d,function(e,s,r,o){let h=t.substring(n,o);return h.length&&i.push({type:f,value:h}),i.push({type:"c"==s?g:p,value:r.trim()}),n=o+e.length,""});let s=t.substring(n);return s.length&&i.push({type:f,value:s}),function(t,e){e||(e=1/0);let i=0,n=0,s=-1;for(;i<t.length;){let r=t[i];if(r.type==_&&(n=0,s=-1),r.type!=f){i++;continue}for(;0==n&&" "==r.value.charAt(0);)r.value=r.value.substring(1);let o=r.value.indexOf("\n");if(-1!=o){r.value=y(t,i,o,!0);let e=r.value.split("");for(;e.length&&" "==e[e.length-1];)e.pop();r.value=e.join("")}if(r.value.length){if(n+r.value.length>e){let o=-1;for(;;){let t=r.value.indexOf(" ",o+1);if(-1==t)break;if(n+t>e)break;o=t}if(-1!=o)r.value=y(t,i,o,!0);else if(-1!=s){let e=t[s],n=e.value.lastIndexOf(" ");e.value=y(t,s,n,!0),i=s}else r.value=y(t,i,e-n,!1)}else n+=r.value.length,-1!=r.value.indexOf(" ")&&(s=i);i++}else t.splice(i,1)}t.push({type:_});let r=null;for(let e=0;e<t.length;e++){let i=t[e];switch(i.type){case f:r=i;break;case _:if(r){let t=r.value.split("");for(;t.length&&" "==t[t.length-1];)t.pop();r.value=t.join("")}r=null}}return t.pop(),t}(i,e)}function y(t,e,i,n){let s={type:_},r={type:f,value:t[e].value.substring(i+(n?1:0))};return t.splice(e+1,0,s,r),t[e].value.substring(0,i)}let w=80,v=25;const x={4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},k=13,M=27,S=32,C=37,T=38,j=39,O=40,W=65,A=67,E=68,R=69,D=73,X=75,P=79,Y=80,z=81,U=87,I=88,F=90,H=188,q=190,L=191,B={hex:a,rect:l,tile:c,term:u.a},$={width:w,height:v,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1};class N{constructor(t={}){this._data={},this._dirty=!1,this._options={},t=Object.assign({},$,t),this.setOptions(t),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}DEBUG(t,e,i){let n=[this._options.bg,this._options.fg];this.draw(t,e,null,null,n[i%n.length])}clear(){this._data={},this._dirty=!0}setOptions(t){if(Object.assign(this._options,t),t.width||t.height||t.fontSize||t.fontFamily||t.spacing||t.layout){if(t.layout){let e=B[t.layout];this._backend=new e}this._backend.setOptions(this._options),this._dirty=!0}return this}getOptions(){return this._options}getContainer(){return this._backend.getContainer()}computeSize(t,e){return this._backend.computeSize(t,e)}computeFontSize(t,e){return this._backend.computeFontSize(t,e)}computeTileSize(t,e){return[Math.floor(t/this._options.width),Math.floor(e/this._options.height)]}eventToPosition(t){let e,i;return"touches"in t?(e=t.touches[0].clientX,i=t.touches[0].clientY):(e=t.clientX,i=t.clientY),this._backend.eventToPosition(e,i)}draw(t,e,i,n,s){n||(n=this._options.fg),s||(s=this._options.bg);let r=`${t},${e}`;this._data[r]=[t,e,i,n,s],!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[r]=!0)}drawText(t,e,i,n){let s=null,r=null,o=t,h=e,a=1;n||(n=this._options.width-t);let l=b(i,n);for(;l.length;){let e=l.shift();switch(e.type){case f:let i=!1,n=!1,l=!1,c=!1;for(let t=0;t<e.value.length;t++){let a=e.value.charCodeAt(t),u=e.value.charAt(t);l=a>65280&&a<65377||a>65500&&a<65512||a>65518,i=32==u.charCodeAt(0)||12288==u.charCodeAt(0),!c||l||i||o++,l&&!n&&o++,this.draw(o++,h,u,s,r),n=i,c=l}break;case g:s=e.value||null;break;case p:r=e.value||null;break;case _:o=t,h++,a++}}return a}_tick(){if(this._backend.schedule(this._tick),this._dirty){if(!0===this._dirty){this._backend.clear();for(let t in this._data)this._draw(t,!1)}else for(let t in this._dirty)this._draw(t,!0);this._dirty=!1}}_draw(t,e){let i=this._data[t];i[4]!=this._options.bg&&(e=!0),this._backend.draw(i,e)}}N.Rect=l,N.Hex=a,N.Tile=c,N.Term=u.a;class V{constructor(){this._time=0,this._events=[],this._eventTimes=[]}getTime(){return this._time}clear(){return this._events=[],this._eventTimes=[],this}add(t,e){let i=this._events.length;for(let t=0;t<this._eventTimes.length;t++)if(this._eventTimes[t]>e){i=t;break}this._events.splice(i,0,t),this._eventTimes.splice(i,0,e)}get(){if(!this._events.length)return null;let t=this._eventTimes.splice(0,1)[0];if(t>0){this._time+=t;for(let e=0;e<this._eventTimes.length;e++)this._eventTimes[e]-=t}return this._events.splice(0,1)[0]}getEventTime(t){let e=this._events.indexOf(t);if(-1!=e)return this._eventTimes[e]}remove(t){let e=this._events.indexOf(t);return-1!=e&&(this._remove(e),!0)}_remove(t){this._events.splice(t,1),this._eventTimes.splice(t,1)}}class G{constructor(){this._queue=new V,this._repeat=[],this._current=null}getTime(){return this._queue.getTime()}add(t,e){return e&&this._repeat.push(t),this}getTimeOf(t){return this._queue.getEventTime(t)}clear(){return this._queue.clear(),this._repeat=[],this._current=null,this}remove(t){let e=this._queue.remove(t),i=this._repeat.indexOf(t);return-1!=i&&this._repeat.splice(i,1),this._current==t&&(this._current=null),e}next(){return this._current=this._queue.get(),this._current}}var K={Simple:class extends G{add(t,e){return this._queue.add(t,0),super.add(t,e)}next(){return this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,0),super.next()}},Speed:class extends G{add(t,e,i){return this._queue.add(t,void 0!==i?i:1/t.getSpeed()),super.add(t,e)}next(){return this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,1/this._current.getSpeed()),super.next()}},Action:class extends G{constructor(){super(),this._defaultDuration=1,this._duration=this._defaultDuration}add(t,e,i){return this._queue.add(t,i||this._defaultDuration),super.add(t,e)}clear(){return this._duration=this._defaultDuration,super.clear()}remove(t){return t==this._current&&(this._duration=this._defaultDuration),super.remove(t)}next(){return this._current&&-1!=this._repeat.indexOf(this._current)&&(this._queue.add(this._current,this._duration||this._defaultDuration),this._duration=this._defaultDuration),super.next()}setDuration(t){return this._current&&(this._duration=t),this}}};class J{constructor(t=w,e=v){this._width=t,this._height=e}_fillMap(t){let e=[];for(let i=0;i<this._width;i++){e.push([]);for(let n=0;n<this._height;n++)e[i].push(t)}return e}}class Q extends J{constructor(t,e){super(t,e),this._rooms=[],this._corridors=[]}getRooms(){return this._rooms}getCorridors(){return this._corridors}}class Z{}class tt extends Z{constructor(t,e,i,n,s,r){super(),this._x1=t,this._y1=e,this._x2=i,this._y2=n,this._doors={},void 0!==s&&void 0!==r&&this.addDoor(s,r)}static createRandomAt(t,e,i,n,r){let o=r.roomWidth[0],h=r.roomWidth[1],a=s.a.getUniformInt(o,h);o=r.roomHeight[0],h=r.roomHeight[1];let l=s.a.getUniformInt(o,h);if(1==i){let i=e-Math.floor(s.a.getUniform()*l);return new this(t+1,i,t+a,i+l-1,t,e)}if(-1==i){let i=e-Math.floor(s.a.getUniform()*l);return new this(t-a,i,t-1,i+l-1,t,e)}if(1==n){let i=t-Math.floor(s.a.getUniform()*a);return new this(i,e+1,i+a-1,e+l,t,e)}if(-1==n){let i=t-Math.floor(s.a.getUniform()*a);return new this(i,e-l,i+a-1,e-1,t,e)}throw new Error("dx or dy must be 1 or -1")}static createRandomCenter(t,e,i){let n=i.roomWidth[0],r=i.roomWidth[1],o=s.a.getUniformInt(n,r);n=i.roomHeight[0],r=i.roomHeight[1];let h=s.a.getUniformInt(n,r),a=t-Math.floor(s.a.getUniform()*o),l=e-Math.floor(s.a.getUniform()*h);return new this(a,l,a+o-1,l+h-1)}static createRandom(t,e,i){let n=i.roomWidth[0],r=i.roomWidth[1],o=s.a.getUniformInt(n,r);n=i.roomHeight[0],r=i.roomHeight[1];let h=s.a.getUniformInt(n,r),a=t-o-1,l=e-h-1,c=1+Math.floor(s.a.getUniform()*a),u=1+Math.floor(s.a.getUniform()*l);return new this(c,u,c+o-1,u+h-1)}addDoor(t,e){return this._doors[t+","+e]=1,this}getDoors(t){for(let e in this._doors){let i=e.split(",");t(parseInt(i[0]),parseInt(i[1]))}return this}clearDoors(){return this._doors={},this}addDoors(t){let e=this._x1-1,i=this._x2+1,n=this._y1-1,s=this._y2+1;for(let r=e;r<=i;r++)for(let o=n;o<=s;o++)r!=e&&r!=i&&o!=n&&o!=s||t(r,o)||this.addDoor(r,o);return this}debug(){console.log("room",this._x1,this._y1,this._x2,this._y2)}isValid(t,e){let i=this._x1-1,n=this._x2+1,s=this._y1-1,r=this._y2+1;for(let o=i;o<=n;o++)for(let h=s;h<=r;h++)if(o==i||o==n||h==s||h==r){if(!t(o,h))return!1}else if(!e(o,h))return!1;return!0}create(t){let e=this._x1-1,i=this._x2+1,n=this._y1-1,s=this._y2+1,r=0;for(let o=e;o<=i;o++)for(let h=n;h<=s;h++)t(o,h,r=o+","+h in this._doors?2:o==e||o==i||h==n||h==s?1:0)}getCenter(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]}getLeft(){return this._x1}getRight(){return this._x2}getTop(){return this._y1}getBottom(){return this._y2}}class et extends Z{constructor(t,e,i,n){super(),this._startX=t,this._startY=e,this._endX=i,this._endY=n,this._endsWithAWall=!0}static createRandomAt(t,e,i,n,r){let o=r.corridorLength[0],h=r.corridorLength[1],a=s.a.getUniformInt(o,h);return new this(t,e,t+i*a,e+n*a)}debug(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)}isValid(t,e){let i=this._startX,n=this._startY,s=this._endX-i,r=this._endY-n,o=1+Math.max(Math.abs(s),Math.abs(r));s&&(s/=Math.abs(s)),r&&(r/=Math.abs(r));let h=r,a=-s,l=!0;for(let c=0;c<o;c++){let u=i+c*s,d=n+c*r;if(e(u,d)||(l=!1),t(u+h,d+a)||(l=!1),t(u-h,d-a)||(l=!1),!l){o=c,this._endX=u-s,this._endY=d-r;break}}if(0==o)return!1;if(1==o&&t(this._endX+s,this._endY+r))return!1;let c=!t(this._endX+s+h,this._endY+r+a),u=!t(this._endX+s-h,this._endY+r-a);return this._endsWithAWall=t(this._endX+s,this._endY+r),!c&&!u||!this._endsWithAWall}create(t){let e=this._startX,i=this._startY,n=this._endX-e,s=this._endY-i,r=1+Math.max(Math.abs(n),Math.abs(s));n&&(n/=Math.abs(n)),s&&(s/=Math.abs(s));for(let o=0;o<r;o++){t(e+o*n,i+o*s,0)}return!0}createPriorityWalls(t){if(!this._endsWithAWall)return;let e=this._startX,i=this._startY,n=this._endX-e,s=this._endY-i;n&&(n/=Math.abs(n)),s&&(s/=Math.abs(s));let r=s,o=-n;t(this._endX+n,this._endY+s),t(this._endX+r,this._endY+o),t(this._endX-r,this._endY-o)}}const it={room:tt,corridor:et};function nt(t,e,i){i[e[t+1]]=i[t],e[i[t]]=e[t+1],i[t]=t+1,e[t+1]=t}function st(t,e,i){i[e[t]]=i[t],e[i[t]]=e[t],i[t]=t,e[t]=t}var rt={Arena:class extends J{create(t){let e=this._width-1,i=this._height-1;for(let n=0;n<=e;n++)for(let s=0;s<=i;s++)t(n,s,n&&s&&n<e&&s<i?0:1);return this}},Uniform:class extends Q{constructor(t,e,i){super(t,e),this._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:.1,timeLimit:1e3},Object.assign(this._options,i),this._map=[],this._dug=0,this._roomAttempts=20,this._corridorAttempts=20,this._connected=[],this._unconnected=[],this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this)}create(t){let e=Date.now();for(;;){if(Date.now()-e>this._options.timeLimit)return null;if(this._map=this._fillMap(1),this._dug=0,this._rooms=[],this._unconnected=[],this._generateRooms(),!(this._rooms.length<2)&&this._generateCorridors())break}if(t)for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,this._map[e][i]);return this}_generateRooms(){let t,e=this._width-2,i=this._height-2;do{if(t=this._generateRoom(),this._dug/(e*i)>this._options.roomDugPercentage)break}while(t)}_generateRoom(){let t=0;for(;t<this._roomAttempts;){t++;let e=tt.createRandom(this._width,this._height,this._options);if(e.isValid(this._isWallCallback,this._canBeDugCallback))return e.create(this._digCallback),this._rooms.push(e),e}return null}_generateCorridors(){let t=0;for(;t<this._corridorAttempts;){t++,this._corridors=[],this._map=this._fillMap(1);for(let t=0;t<this._rooms.length;t++){let e=this._rooms[t];e.clearDoors(),e.create(this._digCallback)}for(this._unconnected=s.a.shuffle(this._rooms.slice()),this._connected=[],this._unconnected.length&&this._connected.push(this._unconnected.pop());;){let t=s.a.getItem(this._connected);if(!t)break;let e=this._closestRoom(this._unconnected,t);if(!e)break;let i=this._closestRoom(this._connected,e);if(!i)break;if(!this._connectRooms(e,i))break;if(!this._unconnected.length)return!0}}return!1}_closestRoom(t,e){let i=1/0,n=e.getCenter(),s=null;for(let e=0;e<t.length;e++){let r=t[e],o=r.getCenter(),h=o[0]-n[0],a=o[1]-n[1],l=h*h+a*a;l<i&&(i=l,s=r)}return s}_connectRooms(t,e){let i,n,s,r,o,h,a,l=t.getCenter(),c=e.getCenter(),u=c[0]-l[0],d=c[1]-l[1];if(Math.abs(u)<Math.abs(d)?(r=(2+(s=d>0?2:0))%4,o=e.getLeft(),h=e.getRight(),a=0):(r=(2+(s=u>0?1:3))%4,o=e.getTop(),h=e.getBottom(),a=1),!(i=this._placeInWall(t,s)))return!1;if(i[a]>=o&&i[a]<=h){n=i.slice();let t=0;switch(r){case 0:t=e.getTop()-1;break;case 1:t=e.getRight()+1;break;case 2:t=e.getBottom()+1;break;case 3:t=e.getLeft()-1}n[(a+1)%2]=t,this._digLine([i,n])}else if(i[a]<o-1||i[a]>h+1){let t=i[a]-c[a],s=0;switch(r){case 0:case 1:s=t<0?3:1;break;case 2:case 3:s=t<0?1:3}if(r=(r+s)%4,!(n=this._placeInWall(e,r)))return!1;let o=[0,0];o[a]=i[a];let h=(a+1)%2;o[h]=n[h],this._digLine([i,o,n])}else{let t=(a+1)%2;if(!(n=this._placeInWall(e,r)))return!1;let s=Math.round((n[t]+i[t])/2),o=[0,0],h=[0,0];o[a]=i[a],o[t]=s,h[a]=n[a],h[t]=s,this._digLine([i,o,h,n])}return t.addDoor(i[0],i[1]),e.addDoor(n[0],n[1]),-1!=(a=this._unconnected.indexOf(t))&&(this._unconnected.splice(a,1),this._connected.push(t)),-1!=(a=this._unconnected.indexOf(e))&&(this._unconnected.splice(a,1),this._connected.push(e)),!0}_placeInWall(t,e){let i=[0,0],n=[0,0],r=0;switch(e){case 0:n=[1,0],i=[t.getLeft(),t.getTop()-1],r=t.getRight()-t.getLeft()+1;break;case 1:n=[0,1],i=[t.getRight()+1,t.getTop()],r=t.getBottom()-t.getTop()+1;break;case 2:n=[1,0],i=[t.getLeft(),t.getBottom()+1],r=t.getRight()-t.getLeft()+1;break;case 3:n=[0,1],i=[t.getLeft()-1,t.getTop()],r=t.getBottom()-t.getTop()+1}let o=[],h=-2;for(let t=0;t<r;t++){let e=i[0]+t*n[0],s=i[1]+t*n[1];o.push(null),1==this._map[e][s]?h!=t-1&&(o[t]=[e,s]):(h=t,t&&(o[t-1]=null))}for(let t=o.length-1;t>=0;t--)o[t]||o.splice(t,1);return o.length?s.a.getItem(o):null}_digLine(t){for(let e=1;e<t.length;e++){let i=t[e-1],n=t[e],s=new et(i[0],i[1],n[0],n[1]);s.create(this._digCallback),this._corridors.push(s)}}_digCallback(t,e,i){this._map[t][e]=i,0==i&&this._dug++}_isWallCallback(t,e){return!(t<0||e<0||t>=this._width||e>=this._height)&&1==this._map[t][e]}_canBeDugCallback(t,e){return!(t<1||e<1||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]}},Cellular:class extends J{constructor(t,e,i={}){super(t,e),this._options={born:[5,6,7,8],survive:[4,5,6,7,8],topology:8},this.setOptions(i),this._dirs=x[this._options.topology],this._map=this._fillMap(0)}randomize(t){for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)this._map[e][i]=s.a.getUniform()<t?1:0;return this}setOptions(t){Object.assign(this._options,t)}set(t,e,i){this._map[t][e]=i}create(t){let e=this._fillMap(0),i=this._options.born,n=this._options.survive;for(let t=0;t<this._height;t++){let s=1,r=0;6==this._options.topology&&(s=2,r=t%2);for(let o=r;o<this._width;o+=s){let s=this._map[o][t],r=this._getNeighbors(o,t);s&&-1!=n.indexOf(r)?e[o][t]=1:s||-1==i.indexOf(r)||(e[o][t]=1)}}this._map=e,t&&this._serviceCallback(t)}_serviceCallback(t){for(let e=0;e<this._height;e++){let i=1,n=0;6==this._options.topology&&(i=2,n=e%2);for(let s=n;s<this._width;s+=i)t(s,e,this._map[s][e])}}_getNeighbors(t,e){let i=0;for(let n=0;n<this._dirs.length;n++){let s=this._dirs[n],r=t+s[0],o=e+s[1];r<0||r>=this._width||o<0||o>=this._height||(i+=1==this._map[r][o]?1:0)}return i}connect(t,e,i){e||(e=0);let n=[],r={},o=1,h=[0,0];6==this._options.topology&&(o=2,h=[0,1]);for(let t=0;t<this._height;t++)for(let i=h[t%2];i<this._width;i+=o)if(this._freeSpace(i,t,e)){let e=[i,t];r[this._pointKey(e)]=e,n.push([i,t])}let a=n[s.a.getUniformInt(0,n.length-1)],l=this._pointKey(a),c={};for(c[l]=a,delete r[l],this._findConnected(c,r,[a],!1,e);Object.keys(r).length>0;){let t=this._getFromTo(c,r),n=t[0],s=t[1],o={};o[this._pointKey(n)]=n,this._findConnected(o,r,[n],!0,e),(6==this._options.topology?this._tunnelToConnected6:this._tunnelToConnected).call(this,s,n,c,r,e,i);for(let t in o){let i=o[t];this._map[i[0]][i[1]]=e,c[t]=i,delete r[t]}}t&&this._serviceCallback(t)}_getFromTo(t,e){let i,n=[0,0],r=[0,0],o=Object.keys(t),h=Object.keys(e);for(let a=0;a<5;a++){if(o.length<h.length){let i=o;r=t[i[s.a.getUniformInt(0,i.length-1)]],n=this._getClosest(r,e)}else{let i=h;n=e[i[s.a.getUniformInt(0,i.length-1)]],r=this._getClosest(n,t)}if((i=(n[0]-r[0])*(n[0]-r[0])+(n[1]-r[1])*(n[1]-r[1]))<64)break}return[n,r]}_getClosest(t,e){let i=null,n=null;for(let s in e){let r=e[s],o=(r[0]-t[0])*(r[0]-t[0])+(r[1]-t[1])*(r[1]-t[1]);(null==n||o<n)&&(n=o,i=r)}return i}_findConnected(t,e,i,n,s){for(;i.length>0;){let r,o=i.splice(0,1)[0];r=6==this._options.topology?[[o[0]+2,o[1]],[o[0]+1,o[1]-1],[o[0]-1,o[1]-1],[o[0]-2,o[1]],[o[0]-1,o[1]+1],[o[0]+1,o[1]+1]]:[[o[0]+1,o[1]],[o[0]-1,o[1]],[o[0],o[1]+1],[o[0],o[1]-1]];for(let o=0;o<r.length;o++){let h=this._pointKey(r[o]);null==t[h]&&this._freeSpace(r[o][0],r[o][1],s)&&(t[h]=r[o],n||delete e[h],i.push(r[o]))}}}_tunnelToConnected(t,e,i,n,s,r){let o,h;e[0]<t[0]?(o=e,h=t):(o=t,h=e);for(let t=o[0];t<=h[0];t++){this._map[t][o[1]]=s;let e=[t,o[1]],r=this._pointKey(e);i[r]=e,delete n[r]}r&&o[0]<h[0]&&r(o,[h[0],o[1]]);let a=h[0];e[1]<t[1]?(o=e,h=t):(o=t,h=e);for(let t=o[1];t<h[1];t++){this._map[a][t]=s;let e=[a,t],r=this._pointKey(e);i[r]=e,delete n[r]}r&&o[1]<h[1]&&r([h[0],o[1]],[h[0],h[1]])}_tunnelToConnected6(t,e,i,n,s,r){let o,h;e[0]<t[0]?(o=e,h=t):(o=t,h=e);let a=o[0],l=o[1];for(;a!=h[0]||l!=h[1];){let t=2;l<h[1]?(l++,t=1):l>h[1]&&(l--,t=1),a<h[0]?a+=t:a>h[0]?a-=t:h[1]%2?a-=t:a+=t,this._map[a][l]=s;let e=[a,l],r=this._pointKey(e);i[r]=e,delete n[r]}r&&r(e,t)}_freeSpace(t,e,i){return t>=0&&t<this._width&&e>=0&&e<this._height&&this._map[t][e]==i}_pointKey(t){return t[0]+"."+t[1]}},Digger:class extends Q{constructor(t,e,i={}){super(t,e),this._options=Object.assign({roomWidth:[3,9],roomHeight:[3,5],corridorLength:[3,10],dugPercentage:.2,timeLimit:1e3},i),this._features={room:4,corridor:4},this._map=[],this._featureAttempts=20,this._walls={},this._dug=0,this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this),this._priorityWallCallback=this._priorityWallCallback.bind(this)}create(t){this._rooms=[],this._corridors=[],this._map=this._fillMap(1),this._walls={},this._dug=0;let e=(this._width-2)*(this._height-2);this._firstRoom();let i,n=Date.now();do{if(i=0,Date.now()-n>this._options.timeLimit)break;let t=this._findWall();if(!t)break;let e=t.split(","),s=parseInt(e[0]),r=parseInt(e[1]),o=this._getDiggingDirection(s,r);if(!o)continue;let h=0;do{if(h++,this._tryFeature(s,r,o[0],o[1])){this._removeSurroundingWalls(s,r),this._removeSurroundingWalls(s-o[0],r-o[1]);break}}while(h<this._featureAttempts);for(let t in this._walls)this._walls[t]>1&&i++}while(this._dug/e<this._options.dugPercentage||i);if(this._addDoors(),t)for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,this._map[e][i]);return this._walls={},this._map=[],this}_digCallback(t,e,i){0==i||2==i?(this._map[t][e]=0,this._dug++):this._walls[t+","+e]=1}_isWallCallback(t,e){return!(t<0||e<0||t>=this._width||e>=this._height)&&1==this._map[t][e]}_canBeDugCallback(t,e){return!(t<1||e<1||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]}_priorityWallCallback(t,e){this._walls[t+","+e]=2}_firstRoom(){let t=Math.floor(this._width/2),e=Math.floor(this._height/2),i=tt.createRandomCenter(t,e,this._options);this._rooms.push(i),i.create(this._digCallback)}_findWall(){let t=[],e=[];for(let i in this._walls)2==this._walls[i]?e.push(i):t.push(i);let i=e.length?e:t;if(!i.length)return null;let n=s.a.getItem(i.sort());return delete this._walls[n],n}_tryFeature(t,e,i,n){let r=s.a.getWeightedValue(this._features),o=it[r].createRandomAt(t,e,i,n,this._options);return!!o.isValid(this._isWallCallback,this._canBeDugCallback)&&(o.create(this._digCallback),o instanceof tt&&this._rooms.push(o),o instanceof et&&(o.createPriorityWalls(this._priorityWallCallback),this._corridors.push(o)),!0)}_removeSurroundingWalls(t,e){let i=x[4];for(let n=0;n<i.length;n++){let s=i[n],r=t+s[0],o=e+s[1];delete this._walls[r+","+o],r=t+2*s[0],o=e+2*s[1],delete this._walls[r+","+o]}}_getDiggingDirection(t,e){if(t<=0||e<=0||t>=this._width-1||e>=this._height-1)return null;let i=null,n=x[4];for(let s=0;s<n.length;s++){let r=n[s],o=t+r[0],h=e+r[1];if(!this._map[o][h]){if(i)return null;i=r}}return i?[-i[0],-i[1]]:null}_addDoors(){let t=this._map;function e(e,i){return 1==t[e][i]}for(let t=0;t<this._rooms.length;t++){let i=this._rooms[t];i.clearDoors(),i.addDoors(e)}}},EllerMaze:class extends J{create(t){let e,i=this._fillMap(1),n=Math.ceil((this._width-2)/2),r=[],o=[];for(let t=0;t<n;t++)r.push(t),o.push(t);for(r.push(n-1),e=1;e+3<this._height;e+=2)for(let t=0;t<n;t++){let n=2*t+1,h=e;i[n][h]=0,t!=r[t+1]&&s.a.getUniform()>.375&&(nt(t,r,o),i[n+1][h]=0),t!=r[t]&&s.a.getUniform()>.375?st(t,r,o):i[n][h+1]=0}for(let t=0;t<n;t++){let n=2*t+1,h=e;i[n][h]=0,t!=r[t+1]&&(t==r[t]||s.a.getUniform()>.375)&&(nt(t,r,o),i[n+1][h]=0),st(t,r,o)}for(let e=0;e<this._width;e++)for(let n=0;n<this._height;n++)t(e,n,i[e][n]);return this}},DividedMaze:class extends J{constructor(){super(...arguments),this._stack=[],this._map=[]}create(t){let e=this._width,i=this._height;this._map=[];for(let t=0;t<e;t++){this._map.push([]);for(let n=0;n<i;n++){let s=0==t||0==n||t+1==e||n+1==i;this._map[t].push(s?1:0)}}this._stack=[[1,1,e-2,i-2]],this._process();for(let n=0;n<e;n++)for(let e=0;e<i;e++)t(n,e,this._map[n][e]);return this._map=[],this}_process(){for(;this._stack.length;){let t=this._stack.shift();this._partitionRoom(t)}}_partitionRoom(t){let e=[],i=[];for(let i=t[0]+1;i<t[2];i++){let n=this._map[i][t[1]-1],s=this._map[i][t[3]+1];!n||!s||i%2||e.push(i)}for(let e=t[1]+1;e<t[3];e++){let n=this._map[t[0]-1][e],s=this._map[t[2]+1][e];!n||!s||e%2||i.push(e)}if(!e.length||!i.length)return;let n=s.a.getItem(e),r=s.a.getItem(i);this._map[n][r]=1;let o=[],h=[];o.push(h);for(let e=t[0];e<n;e++)this._map[e][r]=1,h.push([e,r]);h=[],o.push(h);for(let e=n+1;e<=t[2];e++)this._map[e][r]=1,h.push([e,r]);h=[],o.push(h);for(let e=t[1];e<r;e++)this._map[n][e]=1,h.push([n,e]);h=[],o.push(h);for(let e=r+1;e<=t[3];e++)this._map[n][e]=1,h.push([n,e]);let a=s.a.getItem(o);for(let t=0;t<o.length;t++){let e=o[t];if(e==a)continue;let i=s.a.getItem(e);this._map[i[0]][i[1]]=0}this._stack.push([t[0],t[1],n-1,r-1]),this._stack.push([n+1,t[1],t[2],r-1]),this._stack.push([t[0],r+1,n-1,t[3]]),this._stack.push([n+1,r+1,t[2],t[3]])}},IceyMaze:class extends J{constructor(t,e,i=0){super(t,e),this._regularity=i,this._map=[]}create(t){let e=this._width,i=this._height,n=this._fillMap(1);e-=e%2?1:2,i-=i%2?1:2;let r=0,o=0,h=0,a=0,l=0,c=!1,u=[[0,0],[0,0],[0,0],[0,0]];do{if(r=1+2*Math.floor(s.a.getUniform()*(e-1)/2),o=1+2*Math.floor(s.a.getUniform()*(i-1)/2),l||(n[r][o]=0),!n[r][o]){this._randomize(u);do{0==Math.floor(s.a.getUniform()*(this._regularity+1))&&this._randomize(u),c=!0;for(let t=0;t<4;t++)if(h=r+2*u[t][0],a=o+2*u[t][1],this._isFree(n,h,a,e,i)){n[h][a]=0,n[r+u[t][0]][o+u[t][1]]=0,r=h,o=a,c=!1,l++;break}}while(!c)}}while(l+1<e*i/4);for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,n[e][i]);return this._map=[],this}_randomize(t){for(let e=0;e<4;e++)t[e][0]=0,t[e][1]=0;switch(Math.floor(4*s.a.getUniform())){case 0:t[0][0]=-1,t[1][0]=1,t[2][1]=-1,t[3][1]=1;break;case 1:t[3][0]=-1,t[2][0]=1,t[1][1]=-1,t[0][1]=1;break;case 2:t[2][0]=-1,t[3][0]=1,t[0][1]=-1,t[1][1]=1;break;case 3:t[1][0]=-1,t[0][0]=1,t[3][1]=-1,t[2][1]=1}}_isFree(t,e,i,n,s){return!(e<1||i<1||e>=n||i>=s)&&t[e][i]}},Rogue:class extends J{constructor(t,e,i){super(t,e),this.map=[],this.rooms=[],this.connectedCells=[],(i=Object.assign({cellWidth:3,cellHeight:3},i)).hasOwnProperty("roomWidth")||(i.roomWidth=this._calculateRoomSize(this._width,i.cellWidth)),i.hasOwnProperty("roomHeight")||(i.roomHeight=this._calculateRoomSize(this._height,i.cellHeight)),this._options=i}create(t){if(this.map=this._fillMap(1),this.rooms=[],this.connectedCells=[],this._initRooms(),this._connectRooms(),this._connectUnconnectedRooms(),this._createRandomRoomConnections(),this._createRooms(),this._createCorridors(),t)for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,this.map[e][i]);return this}_calculateRoomSize(t,e){let i=Math.floor(t/e*.8),n=Math.floor(t/e*.25);return n<2&&(n=2),i<2&&(i=2),[n,i]}_initRooms(){for(let t=0;t<this._options.cellWidth;t++){this.rooms.push([]);for(let e=0;e<this._options.cellHeight;e++)this.rooms[t].push({x:0,y:0,width:0,height:0,connections:[],cellx:t,celly:e})}}_connectRooms(){let t,e,i,n,r,o,h=s.a.getUniformInt(0,this._options.cellWidth-1),a=s.a.getUniformInt(0,this._options.cellHeight-1),l=!1;do{o=[0,2,4,6],o=s.a.shuffle(o);do{if(l=!1,t=o.pop(),e=h+x[8][t][0],i=a+x[8][t][1],!(e<0||e>=this._options.cellWidth||i<0||i>=this._options.cellHeight)){if((n=this.rooms[h][a]).connections.length>0&&n.connections[0][0]==e&&n.connections[0][1]==i)break;0==(r=this.rooms[e][i]).connections.length&&(r.connections.push([h,a]),this.connectedCells.push([e,i]),h=e,a=i,l=!0)}}while(o.length>0&&0==l)}while(o.length>0)}_connectUnconnectedRooms(){let t,e,i,n=this._options.cellWidth,r=this._options.cellHeight;this.connectedCells=s.a.shuffle(this.connectedCells);for(let o=0;o<this._options.cellWidth;o++)for(let h=0;h<this._options.cellHeight;h++)if(0==(t=this.rooms[o][h]).connections.length){let a=[0,2,4,6];a=s.a.shuffle(a),i=!1;do{let t=a.pop(),s=o+x[8][t][0],l=h+x[8][t][1];if(!(s<0||s>=n||l<0||l>=r)){if(i=!0,0==(e=this.rooms[s][l]).connections.length)break;for(let t=0;t<e.connections.length;t++)if(e.connections[t][0]==o&&e.connections[t][1]==h){i=!1;break}if(i)break}}while(a.length);i?t.connections.push([e.cellx,e.celly]):console.log("-- Unable to connect room.")}}_createRandomRoomConnections(){}_createRooms(){let t,e,i,n,r,o=this._width,h=this._height,a=this._options.cellWidth,l=this._options.cellHeight,c=Math.floor(this._width/a),u=Math.floor(this._height/l),d=this._options.roomWidth,f=this._options.roomHeight;for(let _=0;_<a;_++)for(let a=0;a<l;a++){if(0==(i=c*_)&&(i=1),0==(n=u*a)&&(n=1),t=s.a.getUniformInt(d[0],d[1]),e=s.a.getUniformInt(f[0],f[1]),a>0)for(r=this.rooms[_][a-1];n-(r.y+r.height)<3;)n++;if(_>0)for(r=this.rooms[_-1][a];i-(r.x+r.width)<3;)i++;let l=Math.round(s.a.getUniformInt(0,c-t)/2),g=Math.round(s.a.getUniformInt(0,u-e)/2);for(;i+l+t>=o;)l?l--:t--;for(;n+g+e>=h;)g?g--:e--;i+=l,n+=g,this.rooms[_][a].x=i,this.rooms[_][a].y=n,this.rooms[_][a].width=t,this.rooms[_][a].height=e;for(let s=i;s<i+t;s++)for(let t=n;t<n+e;t++)this.map[s][t]=0}}_getWallPosition(t,e){let i,n,r;return 1==e||3==e?(i=s.a.getUniformInt(t.x+1,t.x+t.width-2),r=1==e?1+(n=t.y-2):(n=t.y+t.height+1)-1,this.map[i][r]=0):(n=s.a.getUniformInt(t.y+1,t.y+t.height-2),r=2==e?(i=t.x+t.width+1)-1:1+(i=t.x-2),this.map[r][n]=0),[i,n]}_drawCorridor(t,e){let i,n,r,o,h=e[0]-t[0],a=e[1]-t[1],l=t[0],c=t[1],u=[],d=Math.abs(h),f=Math.abs(a),_=s.a.getUniform(),g=_,p=1-_;for(n=h>0?2:6,r=a>0?4:0,d<f?(i=Math.ceil(f*g),u.push([r,i]),u.push([n,d]),i=Math.floor(f*p),u.push([r,i])):(i=Math.ceil(d*g),u.push([n,i]),u.push([r,f]),i=Math.floor(d*p),u.push([n,i])),this.map[l][c]=0;u.length>0;)for(o=u.pop();o[1]>0;)l+=x[8][o[0]][0],c+=x[8][o[0]][1],this.map[l][c]=0,o[1]=o[1]-1}_createCorridors(){let t,e,i,n,s,r=this._options.cellWidth,o=this._options.cellHeight;for(let h=0;h<r;h++)for(let r=0;r<o;r++){t=this.rooms[h][r];for(let r=0;r<t.connections.length;r++)e=t.connections[r],(i=this.rooms[e[0]][e[1]]).cellx>t.cellx?(n=2,s=4):i.cellx<t.cellx?(n=4,s=2):i.celly>t.celly?(n=3,s=1):(n=1,s=3),this._drawCorridor(this._getWallPosition(t,n),this._getWallPosition(i,s))}}}};Math.sqrt(3),Math.sqrt(3);class ot{constructor(t){this._scheduler=t,this._lock=1}start(){return this.unlock()}lock(){return this._lock++,this}unlock(){if(!this._lock)throw new Error("Cannot unlock unlocked engine");for(this._lock--;!this._lock;){let t=this._scheduler.next();if(!t)return this.lock();let e=t.act();e&&e.then&&(this.lock(),e.then(this.unlock.bind(this)))}return this}}var ht=i(2);const at=ht;var lt=class{constructor(t={}){this.char=t.character||" ",this.foreground=t.foreground||"white",this.background=t.blackground||"black"}getChar(){return this.char}getForeground(){return this.foreground}getBackground(){return this.background}};class ct extends lt{constructor(t={}){super(t),this.walkable=t.walkable||!1,this.diggable=t.diggable||!1}isWalkable(){return this.walkable}isDiggable(){return this.diggable}}const ut=new ct,dt=new ct({character:".",walkable:!0}),ft=new ct({character:"#",foreground:"goldenrod",diggable:!0});var _t=i(18),gt=i.n(_t);class pt extends lt{constructor(t={},e){super(t),this.game=e,this.name=t.name||"",this.x=t.x||0,this.y=t.y||0,this.map=null,this.attachedMixins={},this.attachedMixinGroups={},(t.mixins||[]).forEach(function(e){gt()(this,e),this.attachedMixins[e.name]=!0,e.groupName&&(this.attachedMixinGroups[e.groupName]=!0),e.init&&e.init.call(this,t)}.bind(this))}setMap(t){this.map=t}getMap(){return this.map}setName(t){this.name=t}setX(t){this.x=t}setY(t){this.y=t}getName(){return this.name}getX(){return this.x}getY(){return this.y}hasMixin(t){return"object"==typeof t?this.attachedMixins[t.name]:this.attachedMixins[t]||this.attachedMixinGroups[t]}}const mt={};mt.Moveable={name:"Moveable",tryMove(t,e,i){const n=i.getTile(t,e),s=i.getEntityAt(t,e);return s?!!this.hasMixin("Attacker")&&(this.attack(s),!0):n.isWalkable()?(this.x=t,this.y=e,!0):!!n.isDiggable()&&(i.dig(t,e),!0)}},mt.PlayerActor={name:"PlayerActor",groupName:"Actor",act(){this.game.refresh(),this.getMap().getEngine().lock()}},mt.FungusActor={name:"FungusActor",groupName:"Actor",act(){}},mt.Destructible={name:"Destructible",init(t){this.maxHP=t.maxHP||10,this.hp=t.hp||this.maxHP,this.defenseValue=t.defenseValue||0},getHP(){return this.hp},getMaxHP(){return this.maxHP},getDefenseValue(){return this.defenseValue},takeDamage(t,e){this.hp-=e,this.hp<=0&&this.getMap().removeEntity(this)}},mt.Attacker={name:"Attacker",groupName:"Attacker",init(t){this.attackValue=t.attackValue||1},attack(t){if(t.hasMixin("Destructible")){const e=this.getAttackValue(),i=t.getDefenseValue(),n=Math.max(0,e-i);t.takeDamage(this,1+Math.floor(Math.random()*n))}}},mt.FungusActor={name:"FungusActor",groupName:"Actor",init(){this.growthsRemaining=5},act(){if(this.growthsRemaining>0&&Math.random()<=.03){const t=Math.floor(3*Math.random())-1,e=Math.floor(3*Math.random())-1;if((0!==t||0!==e)&&this.getMap().isEmptyFloor(this.getX()+t,this.getY()+e)){const i=new pt(bt.FungusTemplate);i.setX(this.getX()+t),i.setY(this.getY()+e),this.getMap().addEntity(i),this.growthsRemaining--}}}},mt.MessageRecipient={name:"MessageRecipient",init(t){this.messages=[]},receiveMessage(t){this.messages.push(t)}};const bt={};bt.PlayerTemplate={character:"@",foreground:"white",maxHP:15,attackValue:5,defenseValue:2,mixins:[mt.Moveable,mt.PlayerActor,mt.Attacker,mt.Destructible]},bt.FungusTemplate={character:"F",foreground:"green",maxHP:6,mixins:[mt.FungusActor,mt.Destructible]};var yt=class{constructor(t,e){this.tiles=t,this.width=t.length,this.height=t[0].length,this.entities=[],this.scheduler=new K.Simple,this.engine=new ot(this.scheduler),this.addEntityAtRandomPosition(e);for(let t=0;t<50;t++)this.addEntityAtRandomPosition(new pt(bt.FungusTemplate))}getEngine(){return this.engine}getEntities(){return this.entities}getEntityAt(t,e){for(let i=0;i<this.entities.length;i++)if(this.entities[i].getX()===t&&this.entities[i].getY()===e)return this.entities[i];return!1}getWidth(){return this.width}getHeight(){return this.height}getTile(t,e){return t<0||t>=this.width||e<0||e>=this.height?ut:this.tiles[t][e]||ut}dig(t,e){this.getTile(t,e).isDiggable()&&(this.tiles[t][e]=dt)}getRandomFloorPosition(){let t,e;do{t=Math.floor(Math.random()*this.width),e=Math.floor(Math.random()*this.width)}while(!this.isEmptyFloor(t,e));return{x:t,y:e}}addEntity(t){if(t.getX()<0||t.getX()>=this.width||t.getY()<0||t.getY()>=this.height)throw new Error("Adding entity out of bounds.");t.setMap(this),this.entities.push(t),t.hasMixin("Actor")&&this.scheduler.add(t,!0)}addEntityAtRandomPosition(t){const e=this.getRandomFloorPosition();t.setX(e.x),t.setY(e.y),this.addEntity(t)}removeEntity(t){for(let e=0;e<this.entities.length;e++)if(this.entities[e]===t){this.entities.splice(e,1);break}t.hasMixin("Actor")&&this.scheduler.remove(t)}isEmptyFloor(t,e){return this.getTile(t,e)===dt&&!this.getEntityAt(t,e)}};class wt{constructor(t){this.screen_type=t}enter(){console.log(`Entered ${this.screen_type} screen.`)}exit(){console.log(`Exited ${this.screen_type} screen.`)}handleEvent(t){}}const vt=new wt("start");vt.render=function(t,e){e.drawText(1,1,"%c{yellow}Welcome to Thiefesque. Feel free to dig around."),e.drawText(1,2,"Press [Enter] to start.")},vt.handleEvent=function(t,e){e.keyCode!==S&&e.keyCode!==k||t.switchScreen(t.screens.playScreen)};const xt=new wt("play");xt.enter=function(t){const e=[];for(let t=0;t<100;t++){e.push([]);for(let i=0;i<100;i++)e[t].push(ut)}new rt.Digger(100,100).create((t,i,n)=>{e[t][i]=n?ft:dt}),this.player=new pt(bt.PlayerTemplate,t),this.map=new yt(e,this.player),this.map.getEngine().start()},xt.move=function(t,e,i){const n=this.player.getX()+t,s=this.player.getY()+e;this.player.tryMove(n,s,this.map),i.refresh()},xt.render=function(t,e){const i=t.getScreenWidth(),n=t.getScreenHeight();let s=Math.max(0,this.player.getX()-Math.floor(i/2));s=Math.min(s,this.map.getWidth()-i);let r=Math.max(0,this.player.getY()-Math.floor(n/2));r=Math.min(r,this.map.getHeight()-n);for(let t=s;t<s+i;t++)for(let i=r;i<r+n;i++){const n=this.map.getTile(t,i);e.draw(t-s,i-r,n.getChar(),n.getForeground(),n.getBackground())}this.map.getEntities().forEach(t=>{t.getX()>=s&&t.getY()>=r&&t.getX()<s+i&&t.getY()<r+n&&e.draw(t.getX()-s,t.getY()-r,t.getChar(),t.getForeground(),t.getBackground())})},xt.handleEvent=function(t,e){switch(e.keyCode){case S:case k:t.switchScreen(t.screens.winScreen);break;case M:t.switchScreen(t.screens.loseScreen);break;case P:case U:case T:this.move(0,-1,t),this.map.getEngine().unlock();break;case Y:case R:this.move(1,-1,t),this.map.getEngine().unlock();break;case 186:case E:case j:this.move(1,0,t),this.map.getEngine().unlock();break;case L:case A:this.move(1,1,t),this.map.getEngine().unlock();break;case q:case I:case O:this.move(0,1,t),this.map.getEngine().unlock();break;case H:case F:this.move(-1,1,t),this.map.getEngine().unlock();break;case X:case W:case C:this.move(-1,0,t),this.map.getEngine().unlock();break;case D:case z:this.move(-1,-1,t),this.map.getEngine().unlock()}};const kt=new wt("win");kt.render=function(t,e){for(let t=0;t<22;t++){const i=Math.round(255*Math.random()),n=Math.round(255*Math.random()),s=Math.round(255*Math.random()),r=at.toRGB([i,n,s]);e.drawText(2,t+1,`%b{${r}}You win!`)}};const Mt=new wt("lose");Mt.render=function(t,e){for(let t=0;t<22;t++)e.drawText(2,t+1,"%b{red}You lose! :(")};var St=class{constructor(){this.map={},this.screenWidth=80,this.screenHeight=40,this.display=new N({width:this.screenWidth,height:this.screenHeight}),document.body.appendChild(this.display.getContainer()),this.screens={startScreen:vt,playScreen:xt,winScreen:kt,loseScreen:Mt},this.screens.startScreen.handleEvent=this.screens.startScreen.handleEvent.bind(this.screens.startScreen,this),this.screens.playScreen.handleEvent=this.screens.playScreen.handleEvent.bind(this.screens.playScreen,this),this.switchScreen(this.screens.startScreen)}getDisplay(){return this.display}getScreenWidth(){return this.screenWidth}getScreenHeight(){return this.screenHeight}switchScreen(t){this.currentScreen&&(window.removeEventListener("keydown",this.currentScreen),this.currentScreen.exit()),this.getDisplay().clear(),this.currentScreen=t,this.currentScreen&&(this.currentScreen.enter(this),this.refresh()),window.addEventListener("keydown",this.currentScreen)}refresh(){this.display.clear(),this.currentScreen.render(this,this.display)}};document.addEventListener("DOMContentLoaded",()=>{new St})}]);